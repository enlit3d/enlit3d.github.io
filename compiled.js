var G;function aa(a){var d=0;return function(){return d<a.length?{done:!1,value:a[d++]}:{done:!0}}}function ba(a,d,e){void 0!==a&&void 0!==d&&void 0!==e?(this[0]=a,this[1]=d,this[2]=e):void 0!==a?(this[0]=a[0],this[1]=a[1],this[2]=a[2]):(this[0]=0,this[1]=0,this[2]=0)}G=ba.prototype;G.ej=function(a,d){this[0]=a[0]+d[0];this[1]=a[1]+d[1];this[2]=a[2]+d[2];return this};function ca(a,d,e){a[0]=d[0]-e[0];a[1]=d[1]-e[1];a[2]=d[2]-e[2];return a}
G.Z=function(a,d){this[0]=a[0]*d[0];this[1]=a[1]*d[1];this[2]=a[2]*d[2];return this};function da(a,d){a[0]+=d[0];a[1]+=d[1];a[2]+=d[2];return a}G.td=function(a,d){this[0]+=a[0]*d;this[1]+=a[1]*d;this[2]+=a[2]*d;return this};G.scale=function(a){if(DEV&&a.length)throw Error();this[0]*=a;this[1]*=a;this[2]*=a;return this};G.Th=function(){return Math.sqrt(this.cd())};G.cd=function(){var a=this[0],d=this[1],e=this[2];return a*a+d*d+e*e};
G.truncate=function(a){var d=this.cd();return d<a*a?this:this.scale(a/Math.sqrt(d))};G.normalize=function(){var a=this[0],d=this[1],e=this[2];a=a*a+d*d+e*e;0<a&&(a=1/Math.sqrt(a),this[0]*=a,this[1]*=a,this[2]*=a);return this};function ea(a,d,e){var c=d[0],h=d[1];d=d[2];var q=e[0],r=e[1];e=e[2];a[0]=h*e-d*r;a[1]=d*q-c*e;a[2]=c*r-h*q;return a}G.cc=function(a){return this[0]*a[0]+this[1]*a[1]+this[2]*a[2]};
G.Cb=function(a,d,e){this[0]=a[0]+(d[0]-a[0])*e;this[1]=a[1]+(d[1]-a[1])*e;this[2]=a[2]+(d[2]-a[2])*e;return this};G.Ya=function(a){var d=a[0],e=a[1],c=a[2];a=a[3];var h=this[0],q=this[1],r=this[2],g=2*(e*r-c*q),p=2*(c*h-d*r),m=2*(d*q-e*h);this[0]=h+a*g+(e*m-c*p);this[1]=q+a*p+(c*g-d*m);this[2]=r+a*m+(d*p-e*g);return this};function fa(a,d){var e=a[0],c=a[1],h=a[2];a[0]=d[0]*e+d[4]*c+d[8]*h+d[12];a[1]=d[1]*e+d[5]*c+d[9]*h+d[13];a[2]=d[2]*e+d[6]*c+d[10]*h+d[14]}
G.f=function(a){this[0]=a[0];this[1]=a[1];this[2]=a[2];return this};G.M=function(a,d){this[0]=a[d];this[1]=a[d+1];this[2]=a[d+2];return this};function ia(a,d,e,c){a[0]=d;a[1]=e;a[2]=c;return a}G.gc=function(a){return Math.abs(a[0]-this[0])<L&&Math.abs(a[1]-this[1])<L&&Math.abs(a[2]-this[2])<L};G.Pk=function(a,d){var e=a[0]-this[0],c=a[1]-this[1],h=a[2]-this[2];e=Math.sqrt(e*e+c*c+h*h);e<=d?this.f(a):(e=d/e,this[0]+=(a[0]-this[0])*e,this[1]+=(a[1]-this[1])*e,this[2]+=(a[2]-this[2])*e);return this};
G.verify=function(){if(isNaN(this[0])||isNaN(this[1])||isNaN(this[2]))throw Error(this);};G.toString=function(a){a=void 0!==a?a:2;return"("+this[0].toFixed(a)+","+this[1].toFixed(a)+","+this[2].toFixed(a)+")"};function ka(a,d,e,c){void 0!==a&&void 0!==d&&void 0!==e&&void 0!==c?this.zd(a,d,e,c):void 0!==a?this.f(a):this.wb();this.length=4;return this}function la(a,d,e){e/=2;var c=Math.sin(e);a[0]=c*d[0];a[1]=c*d[1];a[2]=c*d[2];a[3]=Math.cos(e);return a}G=ka.prototype;
G.ej=function(a,d){this[0]=a[0]+d[0];this[1]=a[1]+d[1];this[2]=a[2]+d[2];this[3]=a[3]+d[3];return this};G.scale=function(a){this[0]*=a;this[1]*=a;this[2]*=a;this[3]*=a;return this};G.Z=function(a,d){var e=a[0],c=a[1],h=a[2],q=a[3],r=d[0],g=d[1],p=d[2],m=d[3];this[0]=e*m+r*q+c*p-h*g;this[1]=c*m+g*q+h*r-e*p;this[2]=h*m+p*q+e*g-c*r;this[3]=q*m-e*r-c*g-h*p;return this};G.Ya=function(a){return this.Z(a,this)};
G.Cb=function(a,d,e){this[0]=a[0]+(d[0]-a[0])*e;this[1]=a[1]+(d[1]-a[1])*e;this[2]=a[2]+(d[2]-a[2])*e;this[3]=a[3]+(d[3]-a[3])*e;return this};function ma(a,d,e,c){0>d.cc(e)&&(d=a.zd(-d[0],-d[1],-d[2],-d[3]));a.Cb(d,e,c).normalize()}G.normalize=function(){var a=this[0],d=this[1],e=this[2],c=this[3],h=a*a+d*d+e*e+c*c;0<h&&(h=1/Math.sqrt(h),this[0]=a*h,this[1]=d*h,this[2]=e*h,this[3]=c*h);return this};G.cc=function(a){return this[0]*a[0]+this[1]*a[1]+this[2]*a[2]+this[3]*a[3]};
G.Th=function(){var a=this[0],d=this[1],e=this[2],c=this[3];return Math.sqrt(a*a+d*d+e*e+c*c)};G.cd=function(){var a=this[0],d=this[1],e=this[2],c=this[3];return a*a+d*d+e*e+c*c};G.f=function(a){this[0]=a[0];this[1]=a[1];this[2]=a[2];this[3]=a[3];return this};G.zd=function(a,d,e,c){this[0]=a;this[1]=d;this[2]=e;this[3]=c;return this};G.wb=function(){this[0]=0;this[1]=0;this[2]=0;this[3]=1;return this};
G.gc=function(a){return Math.abs(a[0]-this[0])<L&&Math.abs(a[1]-this[1])<L&&Math.abs(a[2]-this[2])<L&&Math.abs(a[2]-this[2])<L};G.verify=function(){if(isNaN(this[0])||isNaN(this[1])||isNaN(this[2])||isNaN(this[3]))throw Error(this);};function na(a){void 0!==a?this.f(a):(this[0]=1,this[5]=1,this[10]=1,this[15]=1);return this}G=na.prototype;
G.Z=function(a,d){var e=a[0],c=a[1],h=a[2],q=a[3],r=a[4],g=a[5],p=a[6],m=a[7],f=a[8],k=a[9],n=a[10],t=a[11],x=a[12],y=a[13],B=a[14],z=a[15],A=d[0],K=d[1],w=d[2],H=d[3];this[0]=A*e+K*r+w*f+H*x;this[1]=A*c+K*g+w*k+H*y;this[2]=A*h+K*p+w*n+H*B;this[3]=A*q+K*m+w*t+H*z;A=d[4];K=d[5];w=d[6];H=d[7];this[4]=A*e+K*r+w*f+H*x;this[5]=A*c+K*g+w*k+H*y;this[6]=A*h+K*p+w*n+H*B;this[7]=A*q+K*m+w*t+H*z;A=d[8];K=d[9];w=d[10];H=d[11];this[8]=A*e+K*r+w*f+H*x;this[9]=A*c+K*g+w*k+H*y;this[10]=A*h+K*p+w*n+H*B;this[11]=A*
q+K*m+w*t+H*z;A=d[12];K=d[13];w=d[14];H=d[15];this[12]=A*e+K*r+w*f+H*x;this[13]=A*c+K*g+w*k+H*y;this[14]=A*h+K*p+w*n+H*B;this[15]=A*q+K*m+w*t+H*z;return this};function oa(a,d,e,c,h,q){var r=new P,g=1/(a-d),p=1/(e-c),m=1/(h-q);r[0]=-2*g;r[1]=0;r[2]=0;r[3]=0;r[4]=0;r[5]=-2*p;r[6]=0;r[7]=0;r[8]=0;r[9]=0;r[10]=2*m;r[11]=0;r[12]=(a+d)*g;r[13]=(c+e)*p;r[14]=(q+h)*m;r[15]=1;return r}
G.perspective=function(a,d,e,c){a=1/Math.tan(a/2);var h=1/(e-c);this[0]=a/d;this[1]=0;this[2]=0;this[3]=0;this[4]=0;this[5]=a;this[6]=0;this[7]=0;this[8]=0;this[9]=0;this[10]=(c+e)*h;this[11]=-1;this[12]=0;this[13]=0;this[14]=2*c*e*h;this[15]=0;return this};
function ra(a){var d=a[0],e=a[1],c=a[2],h=a[3],q=a[4],r=a[5],g=a[6],p=a[7],m=a[8],f=a[9],k=a[10],n=a[11],t=a[12],x=a[13],y=a[14],B=a[15],z=d*r-e*q,A=d*g-c*q,K=d*p-h*q,w=e*g-c*r,H=e*p-h*r,I=c*p-h*g,b=m*x-f*t,l=m*y-k*t,u=m*B-n*t,v=f*y-k*x,C=f*B-n*x,D=k*B-n*y,F=z*D-A*C+K*v+w*u-H*l+I*b;if(!F)return a;F=1/F;a[0]=(r*D-g*C+p*v)*F;a[1]=(c*C-e*D-h*v)*F;a[2]=(x*I-y*H+B*w)*F;a[3]=(k*H-f*I-n*w)*F;a[4]=(g*u-q*D-p*l)*F;a[5]=(d*D-c*u+h*l)*F;a[6]=(y*K-t*I-B*A)*F;a[7]=(m*I-k*K+n*A)*F;a[8]=(q*C-r*u+p*b)*F;a[9]=(e*
u-d*C-h*b)*F;a[10]=(t*H-x*K+B*z)*F;a[11]=(f*K-m*H-n*z)*F;a[12]=(r*l-q*v-g*b)*F;a[13]=(d*v-e*l+c*b)*F;a[14]=(x*A-t*w-y*z)*F;a[15]=(m*w-f*A+k*z)*F;return a}
function sa(a,d,e,c){var h=e[0],q=e[1],r=e[2],g=e[3],p=h+h,m=q+q,f=r+r;e=h*p;var k=h*m;h*=f;var n=q*m;q*=f;r*=f;p*=g;m*=g;g*=f;f=d[0];var t=d[1];d=d[2];a[0]=(1-(n+r))*f;a[1]=(k+g)*f;a[2]=(h-m)*f;a[3]=0;a[4]=(k-g)*t;a[5]=(1-(e+r))*t;a[6]=(q+p)*t;a[7]=0;a[8]=(h+m)*d;a[9]=(q-p)*d;a[10]=(1-(e+n))*d;a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a}
G.translate=function(a){var d=this[1],e=this[2],c=this[3],h=this[5],q=this[6],r=this[7],g=this[9],p=this[10],m=this[11],f=a[0],k=a[1];a=a[2];this[12]+=this[0]*f+this[4]*k+this[8]*a;this[13]+=d*f+h*k+g*a;this[14]+=e*f+q*k+p*a;this[15]+=c*f+r*k+m*a;return this};G.scale=function(a){var d=a[0],e=a[1];a=a[2];this[0]*=d;this[1]*=d;this[2]*=d;this[3]*=d;this[4]*=e;this[5]*=e;this[6]*=e;this[7]*=e;this[8]*=a;this[9]*=a;this[10]*=a;this[11]*=a;return this};
G.td=function(a,d){this[0]+=a[0]*d;this[1]+=a[1]*d;this[2]+=a[2]*d;this[3]+=a[3]*d;this[4]+=a[4]*d;this[5]+=a[5]*d;this[6]+=a[6]*d;this[7]+=a[7]*d;this[8]+=a[8]*d;this[9]+=a[9]*d;this[10]+=a[10]*d;this[11]+=a[11]*d;this[12]+=a[12]*d;this[13]+=a[13]*d;this[14]+=a[14]*d;this[15]+=a[15]*d;return this};G.wb=function(){this[0]=1;this[1]=0;this[2]=0;this[3]=0;this[4]=0;this[5]=1;this[6]=0;this[7]=0;this[8]=0;this[9]=0;this[10]=1;this[11]=0;this[12]=0;this[13]=0;this[14]=0;this[15]=1;return this};
G.f=function(a){this[0]=a[0];this[1]=a[1];this[2]=a[2];this[3]=a[3];this[4]=a[4];this[5]=a[5];this[6]=a[6];this[7]=a[7];this[8]=a[8];this[9]=a[9];this[10]=a[10];this[11]=a[11];this[12]=a[12];this[13]=a[13];this[14]=a[14];this[15]=a[15];return this};
function ta(a,d,e,c){var h=ua(),q=a[0],r=a[1],g=a[2],p=a[3],m=a[4],f=a[5],k=a[6],n=a[7],t=a[8],x=a[9],y=a[10],B=a[11],z=a[12],A=a[13];a=a[14];if(d||e)if(p=(0>q*r*g*p?-1:1)*Math.sqrt(q*q+r*r+g*g),n=(0>m*f*k*n?-1:1)*Math.sqrt(m*m+f*f+k*k),B=(0>t*x*y*B?-1:1)*Math.sqrt(t*t+x*x+y*y),d&&(d[0]=p,d[1]=n,d[2]=B),e){if(0===p||0===n||0===B){e.wb();return}d=1/p;n=1/n;B=1/B;h[0]=q*d;h[1]=r*n;h[2]=g*B;h[4]=m*d;h[5]=f*n;h[6]=k*B;h[8]=t*d;h[9]=x*n;h[10]=y*B;t=h[0];q=h[4];r=h[8];g=h[1];x=h[5];m=h[9];f=h[2];k=h[6];
h=h[10];y=t+x+h;0<y?(h=2*Math.sqrt(y+1),e[0]=(k-m)/h,e[1]=(r-f)/h,e[2]=(g-q)/h,e[3]=.25*h):t>x&&t>h?(h=2*Math.sqrt(1+t-x-h),e[0]=.25*h,e[1]=(q+g)/h,e[2]=(r+f)/h,e[3]=(k-m)/h):x>h?(h=2*Math.sqrt(1+x-t-h),e[0]=(q+g)/h,e[1]=.25*h,e[2]=(m+k)/h,e[3]=(r-f)/h):(h=2*Math.sqrt(1+h-t-x),e[0]=(r+f)/h,e[1]=(m+k)/h,e[2]=.25*h,e[3]=(g-q)/h)}c&&(c[0]=z,c[1]=A,c[2]=a)}
G.M=function(a,d){this[0]=a[d];this[1]=a[d+1];this[2]=a[d+2];this[3]=a[d+3];this[4]=a[d+4];this[5]=a[d+5];this[6]=a[d+6];this[7]=a[d+7];this[8]=a[d+8];this[9]=a[d+9];this[10]=a[d+10];this[11]=a[d+11];this[12]=a[d+12];this[13]=a[d+13];this[14]=a[d+14];this[15]=a[d+15];return this};
G.gc=function(a){return Math.abs(a[0]-this[0])<L&&Math.abs(a[1]-this[1])<L&&Math.abs(a[2]-this[2])<L&&Math.abs(a[3]-this[3])<L&&Math.abs(a[4]-this[4])<L&&Math.abs(a[5]-this[5])<L&&Math.abs(a[6]-this[6])<L&&Math.abs(a[7]-this[7])<L&&Math.abs(a[8]-this[8])<L&&Math.abs(a[9]-this[9])<L&&Math.abs(a[10]-this[10])<L&&Math.abs(a[11]-this[11])<L&&Math.abs(a[12]-this[12])<L&&Math.abs(a[13]-this[13])<L&&Math.abs(a[14]-this[14])<L&&Math.abs(a[15]-this[15])<L};"use strict";
var T=function(a,d){d=d||{alpha:!1,antialias:!0};var e=a.getContext("webgl2",d),c=e?e:a.getContext("webgl",d)||a.getContext("experimental-webgl",d);if(!c)throw Error("init GL context failed.");c.enable(c.DEPTH_TEST);c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA);c.clearColor(.8,.8,.8,1);this.G=c;this.Of=new this.Eg(c,e);var h=this,q=this.Db={si:[],Zi:[],th:null,yk:[],gamma:2.2,cj:{bp:function(p,m){var f=q.cj;if(!f.cb){f.cb=!0;f.hm=[];m=m||16;for(var k=0;k<m;k++){var n=(new R(h.j.ud(-1,1),h.j.ud(-1,1),h.j.ud(-1,
1))).normalize(),t=k/m;t=h.j.pi(.1,1,t);n.scale(t);f.hm[k]=n}f.Ad=new h.qb;f.Ad.Hb=c.REPEAT;f.Ad.Ib=c.REPEAT;f.Ad.hh(16,4,c.UNSIGNED_BYTE,4,4);n=f.Ad.N;t=va();for(k=0;16>k;k++)ia(t,h.j.cg(-1,1),h.j.cg(-1,1),h.j.cg(-1,1)).normalize(),n[4*k]=Math.floor(h.j.fg(t[0],-1,1,0,255)),n[4*k+1]=Math.floor(h.j.fg(t[1],-1,1,0,255)),n[4*k+2]=Math.floor(h.j.fg(t[2],-1,1,0,255)),n[4*k+3]=0;f.Ad.O=!0;f.jq=p}},cb:!1},Gf:{cb:!1,ge:new wa(0,0,0,128),ap:function(p){var m=q.Gf;m.cb=p;return m},eq:function(p,m){var f=q.Gf;
f.ge[0]=p[0];f.ge[1]=p[1];f.ge[2]=p[2];f.ge[3]=m;return f}},gq:{quality:0,To:4}},r=this;this.Oa={$c:0,elapsedTime:0,Bi:new T.Zb.hf,Pg:new Float32Array([0,1024]),Qc:null};this.sc=new RecycledObjs;r.ip=function(){return r.Oa.elapsedTime};r.Jo=function(p){r.Oa.Qc||(r.Oa.Qc=new r.Ym);return r.Oa.Qc.xp(p)};r.Yo=function(p,m){r.Oa.Bi.Fh(p,r.Oa.elapsedTime+m)};r.Sk=function(p,m){var f=r.Oa;f.elapsedTime=m;f.Pg[0]=m;f.Qc&&f.Qc.wq(p,m);f=f.Bi;if(0<f.length)for(;f.Ji()<m;){var k=f.Ef();k&&k.Hf()}};r.fq=function(p,
m){r.G.canvas.width=p;r.G.canvas.height=m};r.lq=function(p,m,f,k){console.log(p,m,f,k);throw Error(p);};e=0;for(var g=T.Rb.length;e<g;e++)T.Rb[e](T,h)}.prototype;
T.pb={co:496,Mb:48,mn:0,ba:1,Lb:2,Ve:4,qj:5,Pm:6,Se:7,vg:8,Te:9,Ue:10,Xm:11,Wm:12,We:14,Jb:15,Va:16,Qm:17,Rm:18,Sm:19,Om:20,Fm:21,Gm:22,Xe:23,wg:24,Tm:25,Um:26,Vm:27,jk:0,Rg:1,pf:2,Kd:3,kk:4,Jd:16,nf:32,gk:64,ik:128,hk:256,lo:192,ko:320,Qg:448,to:3,po:0,qo:1,ro:2,so:3,Ld:12,Ic:4,bf:12,Ed:8,mk:16,Hd:480,Ng:32,Og:64,fk:96,Id:128,Yj:160,Xj:192,$j:224,ek:256,ck:288,dk:320,bk:352,ak:384,Zj:416,Wj:448,Vj:1536,io:512,jo:1024,Gd:1,lf:2,bo:3,Qj:4,mf:5,Hg:6,Rj:7,Fc:930,xj:931,rj:932,Hm:933,uj:934,sj:935,wj:940,
vj:941,Kb:942,Im:943,Km:944,Mm:945,Ec:946,Jm:947,Lm:948,Nm:949,tj:960};
T.types={El:function(a){return null!==a&&("function"===typeof a||"object"===typeof a)},ei:function(a){for(var d in a)if(a.hasOwnProperty(d))return!1;return!0},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},fi:function(a){return"function"===typeof a},Bb:function(a){return"number"===typeof a&&isFinite(a)},gi:function(a){return"number"===typeof a&&isFinite(a)&&0===a%1},lp:function(a){return"boolean"===typeof a},Gl:function(a){return"string"===typeof a}};
T.zb={Ch:function(a,d,e){Blob&&window.navigator.msSaveBlob?(e=a instanceof HTMLCanvasElement?a.wp():new Blob([a]),window.navigator.msSaveBlob(new Blob([e]),d)):a=a instanceof HTMLCanvasElement?a.toDataURL():d.endsWith(".json")?URL&&URL.createObjectURL?URL.createObjectURL(new Blob([a]),{type:"text/json"}):"data:text/json;charset=utf-8,"+a:e?URL.createObjectURL(new Blob([a])):"data:text/plain;charset=utf-8,"+encodeURIComponent(a);e=document.createElement("a");e.href=a;e.download=d;document.body.appendChild(e);
e.click();document.body.removeChild(e);URL&&URL.revokeObjectURL&&URL.revokeObjectURL(e.href)},Fp:function(a){var d=document.createElement("input");d.type="file";d.style.display="none";d.onchange=function(e){if(e=e.target.files[0]){var c=new FileReader;c.onload=function(h){d.ll(h.target.result);document.body.removeChild(d)};c.readAsText(e)}};d.ll=a;document.body.appendChild(d);d.click()},Vi:function(a){return a.replace(/\..*$/,"")},ql:function(a){return(a=a.match(/\.(.*$)/))?a[1]:""},jp:function(a){return(a=
a.match(/.+[/\\]/))?a[0]:""},Qi:function(a){for(var d="",e=0;e<a;e++)d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return d}};T.la={};
(function(){var a=T.la;a.Vo=function(c){var h=document.createElement("textarea");document.body.appendChild(h);h.innerHTML=c;h.select();document.execCommand("copy");document.body.removeChild(h)};a.stringify=function(){function c(r,g){var p=g?" ":"",m={"{":"{"+p,"[":"["+p,"}":p+"}","]":p+"]",",":", ",":":": "};return r.replace(q,function(f,k){return k?f:m[f]})}function h(r,g,p){return g in r?r[g]:p}var q=/("(?:[^\\"]|\\.)*")|[:,\][}{]/g;return function(r,g){g=g||{};var p=JSON.stringify([1],null,h(g,
"indent",4)).slice(2,-3),m=h(g,"margins",!1),f=""===p?Infinity:h(g,"maxLength",100);return function y(n,t,x){n&&"function"===typeof n.toJSON&&(n=n.toJSON());var B=JSON.stringify(n);if(void 0===B)return B;x=f-t.length-x;if(B.length<=x){var z=c(B,m);if(z.length<=x)return z}if("object"===typeof n&&null!==n){var A=t+p,K=[];if(Array.isArray(n)){for(x=0;x<n.length;x++)K.push(y(n[x],A,x===n.length-1?0:1)||"null");x="[]"}else Object.keys(n).forEach(function(w,H,I){var b=JSON.stringify(w)+": ";w=y(n[w],A,
b.length+(H===I.length-1?0:1));void 0!==w&&K.push(b+w)}),x="{}";if(0<K.length)return[x[0],p+K.join(",\n"+A),x[1]].join("\n"+t)}return B}(r,"",0)}}();a.fp=function(){function c(){var r=document.createElement("textarea");r.style.position="absolute";r.style.left="0px";r.style.top="0px";r.style.width="400px";r.style.height="400px";document.body.appendChild(r);r.innerHTML=h.join("\n");r.select();document.execCommand("copy")}var h=[],q=0;Array.prototype.forEach.call(document.getElementsByTagName("script"),
function(r,g){var p=r.src,m=r.innerHTML;if(m)h[g]=m;else{q++;var f=new XMLHttpRequest;f.onreadystatechange=function(){if(200===f.status&&4===f.readyState)h[g]=f.responseText,--q,0===q&&c();else if(404===f.status)throw Error("loading script "+p+" failed.");};f.open("GET",p,!0);f.send()}});0===q&&c()};a.Sb=function(c,h){for(var q=Object.create(c),r=Object.getOwnPropertyNames(h),g=0,p=r.length;g<p;g++){var m=r[g],f=Object.getOwnPropertyDescriptor(h,m);f.get||f.set?Object.defineProperty(q,m,{get:f.get,
set:f.set}):q[m]=h[m]}return q};a.Xi=function(c,h){if(h)for(var q=Object.keys(h),r=0,g=q.length;r<g;r++){var p=q[r];if(void 0===c[p])throw Error(p);c[p]=h[p]}};a.jm=function(c,h){Object.keys(c).forEach(function(q){void 0!==h[q]&&(T.types.El(c[q])?a.jm(c[q],h[q]):c[q]=h[q])})};a.Sj=function(c){this.zf=new T.Zb.hf;this.timestamp=void 0!==c?c:-1};a.Sj.prototype={update:function(c,h){this.timestamp=h;if(0<this.zf.length)for(;this.zf.Ji()<h;)this.zf.Ef()()}};a.Gg=function(){this.v=[0,0];this.padding=[0,
0];this.eb=[-1,-1];this.el=this.Li=!1;this.hc=[];this.qc={};this.Be={}};a.Gg.prototype={Wl:function(c){if(!c.name||!this.Be[c.name]){var h=this.padding[0],q=this.padding[1],r=(c.w||c.width)+2*h,g=(c.o||c.height)+2*q,p=this.fl(r,g);if(null===p&&(this.v[0]+r<this.v[1]+g?(p=this.hj(r,g),null===p&&(p=this.gj(r,g))):(p=this.gj(r,g),null===p&&(p=this.hj(r,g))),null===p))return null;var m=p[0],f=p[1];this.Tk(p,r,g);p=this.dd(c.name);h={x:m+h,y:f+q,w:r-2*h,o:g-2*q,n:c.ze||c.n||void 0};this.qc[p]=h;this.Be[p]=
c;return h}},Vl:function(c){this.mc();c=c.sort(function(p,m){return(m.o||m.height)-(p.o||p.height)});for(var h=null,q=0,r=c.length;q<r;q++){var g=c[q];null===this.Wl(g)&&(h||(h=[]),h.push(g))}return h},mc:function(){this.v=[0,0];this.hc=[];this.qc={};this.Be={}},fl:function(c,h){for(var q=this.hc,r=0,g=q.length;r<g;r++){var p=q[r];if(this.Jk(p,c,h))return p}return null},Jk:function(c,h,q){return h<=c[2]&&q<=c[3]},hj:function(c,h){var q=this.hc,r=this.v[0]+c;r=this.Li?T.j.Ab(r):Math.max(Math.floor(1.1*
this.v[0]),r);if(0<this.eb[0]&&r>this.eb[0])return null;if(h>this.v[1]){if(0<this.eb[0]&&h>this.eb[1])return null;0!==this.v[0]&&q.push([0,this.v[1],this.v[0],h-this.v[1]]);this.v[1]=h}var g=[this.v[0],0,r-this.v[0],this.v[1]];q.push(g);this.v[0]=r;return g},gj:function(c,h){var q=this.hc,r=this.v[1]+h;r=this.Li?T.j.Ab(r):Math.max(Math.floor(1.1*this.v[1]),r);if(0<this.eb[1]&&r>this.eb[1])return null;if(c>this.v[0]){if(0<this.eb[1]&&c>this.eb[0])return null;0!==this.v[1]&&q.push([this.v[0],0,c-this.v[0],
this.v[1]]);this.v[0]=c}var g=[0,this.v[1],this.v[0],r-this.v[1]];q.push(g);this.v[1]=r;return g},Tk:function(c,h,q){var r=[];r[0]=c[0];r[1]=c[1]+q;r[2]=c[2];r[3]=c[3]-q;c[0]+=h;c[1]=c[1];c[2]-=h;c[3]=q;h=this.li(r);this.li(c)?h&&this.hc.push(r):h?(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3]):T.Ua.em(this.hc,c)},li:function(c){return 0<c[2]&&0<c[3]},dd:function(c){for(;!c||void 0!==this.qc[c];)c="img#"+T.zb.Qi(3);return c},Zk:function(c){var h=c instanceof HTMLCanvasElement?c.getContext("2d"):c;h.canvas.width=
this.v[0];h.canvas.height=this.v[1];c=h.canvas;var q=this.Be,r=this.qc,g=this.padding[0],p=this.padding[1],m=(0<=g||0<=p)&&this.el;Object.keys(this.qc).forEach(function(f){var k=q[f],n=r[f];f=n.x;var t=n.y,x=n.w||n.width;n=n.o||n.height;k.Yk?k.Yk(h,f,t):h.drawImage(k,f,t);if(m){for(k=1;k<=p;k++)h.drawImage(c,f,t,x,1,f,t-k,x,1),h.drawImage(c,f,t+n-1,x,1,f,t+n-1+k,x,1);for(k=1;k<=g;k++)h.drawImage(c,f,t-p,1,n+2*p,f-k,t-p,1,n+2*p),h.drawImage(c,f+x-1,t-p,1,n+2*p,f+x-1+k,t-p,1,n+2*p)}})}};a.Kg=function(c){c||
0===c||(c=32);this.tb=c;this.Sc=T.Ua.Ri([],this.tb-1,-1,-1);this.Wb=c;this.Sf=new Set};a.Kg.prototype={Sh:function(){if(!this.Al())return-1;this.Wb--;var c=this.Sc[this.Wb];this.Sf.add(c);return c},jl:function(c){if(!this.Sf.has(c))throw Error();this.Sf["delete"](c);this.Sc[this.Wb]=c;this.Wb++},Cl:function(c){if(!c||c<=this.tb)c=0===this.tb?32:2*this.tb;for(var h=T.Ua.Ri([],c-1,this.tb-1,-1),q=0,r=this.Sc.length;q<r;q++)h.push(this.Sc[q]);this.Sc=h;this.Wb=c-this.tb;return this.tb=c},Al:function(){return 0!==
this.Wb}};var d=document.createElement("canvas"),e=d.getContext("2d");a.Lj=function(c,h,q){void 0!==c&&this.am(c,h,q)};a.Lj.prototype={am:function(c,h,q){c.Kk&&(c=c.Kk);if(c.length){if(!h||!q)throw Error();if(c.length!==h*q*4)throw Error();this.w=h;this.o=q}else{if(h&&q)d.width=h,d.height=q,e.drawImage(c,0,0,h,q),c=e;else if(c instanceof HTMLCanvasElement)c=c.getContext("2d");else if(c instanceof Image)d.width=c.width,d.height=c.height,e.drawImage(c,0,0),c=e;else throw Error();c=c.getImageData(0,
0,c.canvas.width,c.canvas.height);this.w=c.width;this.o=c.height}}};a.Uj=function(){this.Xc=[];for(var c=0;9>c;c++)this.Xc[c]=new R};a.Uj.prototype={Cb:function(c,h,q){for(var r=0;9>r;r++)this.Xc[r].Cb(c.Xc[r],h.Xc[r],q);return this},scale:function(c){for(var h=0;9>h;h++)this.Xc[h].scale(c);return this}};a.Dj=function(){this.keys=[];this.values=[];this.table=[];this.shift=this.max=this.min=this.Ah=0};a.Dj.prototype={clear:function(){this.keys=[];this.values=[];this.table=[];this.shift=this.max=this.min=
this.Ah=0},ul:function(c){if(c<=this.min)return 0;if(c>=this.max)return this.keys.length-1;var h=Math.floor((c-this.shift)/this.Ah);0>h?h=0:h>=this.table.length&&(h=this.table.length-1);h=this.table[h];c<this.keys[h]?h--:h!==this.keys.length-1&&c>this.keys[h+1]&&h++;return h},Rh:function(c){return this.values[c]},toJSON:function(){return[this.keys,this.values]}};a.Ej=function(c,h,q){this.t=void 0!==c?c:-1;this.c=new R(h);this.F=(new xa(q)).normalize();if(!T.types.Bb(this.t))throw Error();this.c.verify();
this.F.verify();this.m=null};a.Ej.prototype={toJSON:function(){var c=T.j.ti,h=this.c,q=this.F;return""+c(h[0],5)+","+c(h[1],5)+","+c(h[2],5)+","+c(q[0],5)+","+c(q[1],5)+","+c(q[2],5)+","+c(q[3],5)}};a.yj=function(){var c=document.createElement("canvas"),h=c.getContext("2d");c.ac=h;c.pq=function(){var q=new Image;q.src=this.toDataURL("image/png");return q};c.tl=function(){return c.ac.getImageData(0,0,c.width,c.height)};c.Wp=function(q,r){this.width=r=r||32;this.height=1;var g=Object.keys(q).sort(),
p=0,m=g[p++];if(1<g.length)var f=g[p++],k=!1;else f=m,k=!0;for(var n=q[m],t=q[f],x=this.tl(),y=x.data,B=0,z=y.length;B<z;){var A=B/4/r;k?A=0:(A=(A-m)/(f-m),1<A&&(m=f,n=t,p+1>=g.length?(k=!0,A=1):(f=g[p++],t=q[f])));y[B++]=n[0]+(t[0]-n[0])*A;y[B++]=n[1]+(t[1]-n[1])*A;y[B++]=n[2]+(t[2]-n[2])*A;y[B++]=n[3]+(t[3]-n[3])*A}this.ac.putImageData(x,0,0);return this};c.nq=function(q,r,g,p){q=Math.floor(255*q);r=Math.floor(255*r);g=Math.floor(255*g);return"rgba("+q+","+r+","+g+","+p+")"};c.kp=function(q){if(!T.types.isArray(q))throw Error();
var r=q[0].w||q[0].width,g=q[0].o||q[0].height,p=this.ac;this.width=r*q.length;this.height=g;for(var m=0,f=q.length;m<f;m++){var k=q[m];if(k===this)throw Error();var n=k.o||k.height;if((k.w||k.width)!==r||n!==g)throw Error();p.drawImage(k,m*r,0)}return this};c.Ip=function(q,r,g){var p=q.w||q.width,m=q.o||q.height;c.width=p+2*r;c.height=m+2*g;h.drawImage(q,r,g);for(var f=1;f<=g;f++)h.drawImage(q,0,0,p,1,r,g-f,p,1),h.drawImage(q,0,m-1,p,1,r,g+m+f-1,p,1);for(q=1;q<=r;q++)h.drawImage(c,r,0,1,c.height,
r-q,0,1,c.height),h.drawImage(c,c.width-1-r,0,1,c.height,r+p+q-1,0,1,c.height);return c};c.Sp=function(q){return c.nm(q)};c.Uo=function(q,r){var g=c.ac;c.width=r;c.height=r;var p=r/2,m=g.createRadialGradient(p,p,0,p,p,p);Object.keys(q).forEach(function(f){f=+f;T.types.Bb(f)&&0<=f&&1>=f&&m.addColorStop(f,q[f])});g.fillStyle=m;g.beginPath();g.arc(p,p,p,0,2*Math.PI);g.closePath();g.fill();return c};c.nm=function(q){c.width=32;c.height=1;h.fillStyle=this.Rf(c.width,c.height,q);h.fillRect(0,0,c.width,
c.height);return c};c.Zp=function(q,r,g,p,m,f){c.width=q;c.height=r;if(m&&f)k=f/2,n=f/2,t=q-f,x=r-f;else var k=0,n=0,t=q,x=r;void 0===g&&(g=5);t<2*g&&(g=t/2);x<2*g&&(g=x/2);h.fillStyle=this.Rf(q,r,p);h.beginPath();h.moveTo(k+g,n);h.lineTo(k+t-g,n);h.quadraticCurveTo(k+t,n,k+t,n+g);h.lineTo(k+t,n+x-g);h.quadraticCurveTo(k+t,n+x,k+t-g,n+x);h.lineTo(k+g,n+x);h.quadraticCurveTo(k,n+x,k,n+x-g);h.lineTo(k,n+g);h.quadraticCurveTo(k,n,k+g,n);h.closePath();m?(h.strokeStyle=c.Rf(q,r,m),h.lineWidth=f||1,h.fill(),
h.stroke()):h.fill();return c};c.Go=function(q,r,g){var p=c.width,m=c.height;r||(r="black");g||(g="Impact");h.font=(.85*m).toFixed(0)+"px "+g;var f=h.measureText(q).width;f>.8*p&&(h.font=(.85*m/(f/(.8*p))).toFixed(0)+"px "+g);h.textBaseline="middle";h.textAlign="center";h.fillStyle=r;h.fillText(q,p/2,m/2);return c};c.Ap=function(q,r,g,p,m){g=g||4;p=p||4;m=m||.75;var f=this.ac;this.width=q;this.height=r;for(var k=f.createImageData(q,r),n=k.data,t=0,x=n.length;t<x;t+=4){var y=T.Ei.Zl(t/4%q,Math.floor(t/
(4*q)),q,r,g,p,m);y=(y+1)/2*255;n[t]=y;n[t+1]=y;n[t+2]=y;n[t+3]=y}f.putImageData(k,0,0);return this};c.Xo=function(q,r,g){var p=this.ac;this.width=q;this.height=r;p.clearRect(0,0,q,r);g(p,this);return this};c.Rf=function(q,r,g){if(null===g)return"rgba(0,0,0,0)";if(T.types.Gl(g))return g;var p=!0===g.vertical?h.createLinearGradient(0,0,0,r):h.createLinearGradient(0,0,q,0);Object.keys(g).forEach(function(m){m=+m;T.types.Bb(m)&&0<=m&&1>=m&&p.addColorStop(m,g[m])});return p};return c}})();T.Ei={};
(function(){function a(m,f,k,n,t){m&=31;f=24>m?f:k;k=16>m?k:n;n=8>m?n:t;return(m&1?-f:f)+(m&2?-k:k)+(m&4?-n:n)}function d(m,f,k,n){m&=15;var t=8>m?f:k;f=4>m?k:12==m||14==m?f:n;return(m&1?-t:t)+(m&2?-f:f)}function e(m,f,k){m&=7;var n=4>m?f:k;f=4>m?k:f;return(m&1?-n:n)+(m&2?-2*f:2*f)}function c(m,f){var k=m&15,n=1+(k&7);4<k&&(n=-n);return n*f}function h(m,f,k){return(1-k)*m+k*f}function q(m){return m*m*m*(m*(6*m-15)+10)}var r=T.Ei,g=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,
30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,
248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,
11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,
232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];Uint8ClampedArray&&(g=new Uint8ClampedArray(g));var p=Math.floor;r.Mp=function(m,f){var k=p(m);var n=m-k;var t=n-1;var x=(k+1)%f&255;k=k%f&255;var y=q(n);k=c(g[k],n);x=c(g[x],t);return.188*h(k,x,y)};r.Xl=function(m,f,k,n){var t=p(m);var x=p(f);var y=
m-t;var B=f-x;var z=y-1;var A=B-1;f=(t+1)%k&255;m=(x+1)%n&255;t=t%k&255;x=x%n&255;n=q(B);k=q(y);var K=e(g[t+g[x]],y,B);y=e(g[t+g[m]],y,A);t=h(K,y,n);K=e(g[f+g[x]],z,B);y=e(g[f+g[m]],z,A);x=h(K,y,n);return.507*h(t,x,k)};r.Yl=function(m,f,k,n,t,x){var y=p(m);var B=p(f);var z=p(k);var A=m-y;f-=B;var K=k-z;var w=A-1;var H=f-1;var I=K-1;k=(y+1)%n&255;m=(B+1)%t&255;var b=(z+1)%x&255;y=y%n&255;B=B%t&255;z=z%x&255;x=q(K);t=q(f);n=q(A);var l=d(g[y+g[B+g[z]]],A,f,K);var u=d(g[y+g[B+g[b]]],A,f,I);var v=h(l,
u,x);l=d(g[y+g[m+g[z]]],A,H,K);u=d(g[y+g[m+g[b]]],A,H,I);A=h(l,u,x);y=h(v,A,t);l=d(g[k+g[B+g[z]]],w,f,K);u=d(g[k+g[B+g[b]]],w,f,I);v=h(l,u,x);l=d(g[k+g[m+g[z]]],w,H,K);u=d(g[k+g[m+g[b]]],w,H,I);A=h(l,u,x);B=h(v,A,t);return.936*h(y,B,n)};r.Np=function(m,f,k,n,t,x,y,B){var z=p(m);var A=p(f);var K=p(k);var w=p(n);m-=z;f-=A;k-=K;var H=n-w;var I=m-1;var b=f-1;var l=k-1;var u=H-1;n=(z+1)%t&255;var v=(A+1)%x&255;var C=(K+1)%y&255;var D=(w+1)%B&255;z=z%t&255;A=A%x&255;K=K%y&255;w=w%B&255;B=q(H);y=q(k);x=
q(f);t=q(m);var F=a(g[z+g[A+g[K+g[w]]]],m,f,k,H);var J=a(g[z+g[A+g[K+g[D]]]],m,f,k,u);var M=h(F,J,B);F=a(g[z+g[A+g[C+g[w]]]],m,f,l,H);J=a(g[z+g[A+g[C+g[D]]]],m,f,l,u);F=h(F,J,B);var O=h(M,F,y);F=a(g[z+g[v+g[K+g[w]]]],m,b,k,H);J=a(g[z+g[v+g[K+g[D]]]],m,b,k,u);M=h(F,J,B);F=a(g[z+g[v+g[C+g[w]]]],m,b,l,H);J=a(g[z+g[v+g[C+g[D]]]],m,b,l,u);F=h(F,J,B);m=h(M,F,y);z=h(O,m,x);F=a(g[n+g[A+g[K+g[w]]]],I,f,k,H);J=a(g[n+g[A+g[K+g[D]]]],I,f,k,u);M=h(F,J,B);F=a(g[n+g[A+g[C+g[w]]]],I,f,l,H);J=a(g[n+g[A+g[C+g[D]]]],
I,f,l,u);F=h(F,J,B);O=h(M,F,y);F=a(g[n+g[v+g[K+g[w]]]],I,b,k,H);J=a(g[n+g[v+g[K+g[D]]]],I,b,k,u);M=h(F,J,B);F=a(g[n+g[v+g[C+g[w]]]],I,b,l,H);J=a(g[n+g[v+g[C+g[D]]]],I,b,l,u);F=h(F,J,B);m=h(M,F,y);A=h(O,m,x);return.87*h(z,A,t)};r.Zl=function(m,f,k,n,t,x,y){m=m*t/k;f=f*t/n;k=0;for(n=1;n<=x;n++){var B=Math.pow(2,n);k+=r.Xl(m*B,f*B,t*B,t*B)*Math.pow(y,n-1)}return 1<k?1:-1>k?-1:k};r.Op=function(m,f,k,n,t,x,y,B,z){m=m*y/n;f=f*y/t;k=k*y/x;n=0;for(t=1;t<=B;t++)x=Math.pow(2,t),n+=r.Yl(m*x,f*x,k*x,y*x,y*x,
y*x)*Math.pow(z,t-1);return 1<n?1:-1>n?-1:n};return r})();var L=1E-4;function ya(){return new Float32Array(2)}var za=new ArrayBuffer(31457280),Ba=0;function R(a,d,e){if(Ba+12>=za.byteLength){var c=new Float32Array(3);DEV&&console.log("Matrix Heap Outta Memory")}else c=new Float32Array(za,Ba,3),Ba+=12;c.__proto__=R.prototype;void 0!==a&&void 0!==d&&void 0!==e?(c[0]=a,c[1]=d,c[2]=e):void 0!==a?(c[0]=a[0],c[1]=a[1],c[2]=a[2]):(c[0]=0,c[1]=0,c[2]=0);return c}
R.prototype=T.la.Sb(Float32Array.prototype,ba.prototype);R.prototype.Tg=new R(1,0,0);new R(0,1,0);R.prototype.qf=new R(0,0,1);new R(0,0,0);function wa(a,d,e,c){var h=new Float32Array(za,Ba,4);Ba+=16;h.__proto__=wa.prototype;void 0!==a&&void 0!==d&&void 0!==e?(h[0]=a,h[1]=d,h[2]=e,h[3]=c):void 0!==a?h.f(a):(h[0]=0,h[1]=0,h[2]=0,h[3]=0);return h}
wa.prototype=T.la.Sb(Float32Array.prototype,{Z:function(a,d){this[0]=a[0]*d[0];this[1]=a[1]*d[1];this[2]=a[2]*d[2];this[3]=a[3]*d[3]},M:function(a,d){this[0]=a[d];this[1]=a[d+1];this[2]=a[d+2];this[3]=a[d+3];return this},f:function(a){this[0]=a[0];this[1]=a[1];this[2]=a[2];this[3]=void 0!==a[3]?a[3]:1;return this},zd:function(a,d,e,c){this[0]=a;this[1]=d;this[2]=e;this[3]=c;return this},gc:function(a){return Math.abs(a[0]-this[0])<L&&Math.abs(a[1]-this[1])<L&&Math.abs(a[2]-this[2])<L&&Math.abs(a[3]-
this[3])<L}});function xa(a){if(Ba+16>=za.byteLength){var d=new Float32Array(4);DEV&&console.log("Matrix Heap Outta Memory")}else d=new Float32Array(za,Ba,4),Ba+=16;d.__proto__=xa.prototype;void 0!==a?d.f(a):d.wb();return d}xa.prototype=T.la.Sb(Float32Array.prototype,ka.prototype);
function P(a){if(Ba+64>=za.byteLength){var d=new Float32Array(16);DEV&&console.log("Matrix Heap Outta Memory")}else d=new Float32Array(za,Ba,16),Ba+=64;d.__proto__=P.prototype;void 0!==a?d.f(a):(d[0]=1,d[5]=1,d[10]=1,d[15]=1);return d}P.prototype=T.la.Sb(Float32Array.prototype,na.prototype);
var Ca=function(){for(var a=[],d=0;256>d;d++)a[d]=new xa;var e=0;return function(){var c=a[e++];256<=e&&(e=0);return c}}(),va=function(){for(var a=[],d=0;2048>d;d++)a[d]=new R;var e=0;return function(c,h,q){var r=a[e++];2048<=e&&(e=0);void 0!==c&&(c.length?r.f(c):void 0!==q&&ia(r,c,h,q));return r}}(),ua=function(){for(var a=[],d=0;64>d;d++)a[d]=new P;var e=0;return function(){var c=a[e++];64<=e&&(e=0);return c}}();
T.Ob=function(){this.h={};this.ka=[];this.ja=[];this.aa=[];this.ha=[];this.lj=this.Gb=this.Xd=this.vf=this.Je=this.re=this.od=this.Wa=this.Zd=this.Yd=null;this.R=this.B=0};function Da(a,d,e,c){a*=c;switch(c){case 1:d[a]=e[0]||e;break;case 2:d[a]=e[0];d[a+1]=e[1];break;case 3:d[a]=e[0];d[a+1]=e[1];d[a+2]=e[2];break;case 4:d[a]=e[0];d[a+1]=e[1];d[a+2]=e[2];d[a+3]=e[3];break;default:throw Error();}}function Ea(a,d){if(0<a.B&&d.length/2!==a.B)throw Error();a.aa=d;a.B=d.length/2}
function Fa(a){if(a.ha&&a.R!==a.B){var d=a.ka,e=a.ja,c=a.aa,h=a.Gb;a.clear();a.ka=[];e&&(a.ja=[]);c&&(a.aa=[]);h&&(a.Gb=[]);a.Xd=[];var q=new R,r=new R,g=new R,p=new wa,m=[new R(1,0,0),new R(0,1,0),new R(0,0,1)],f=m[0],k=function(x){return x[0].toFixed(2)+x[1].toFixed(2)+x[2].toFixed(2)},n=new Map,t=0;a.ha.forEach(function(x){var y=2*x,B=3*x;q.M(d,B);e&&r.M(e,B);c&&g.M(c,y);h&&p.M(h,4*x);f=m[t%3];t++;x=k(q)+k(r)+k(g)+k(f)+(p[0].toFixed(2)+p[1].toFixed(2)+p[2].toFixed(2)+p[3].toFixed(2));y=n.get(x);
void 0===y?(y=a.B,a.B++,Da(y,a.ka,q,3),n.set(x,y),a.ha[a.R++]=y,e&&Da(y,a.ja,r,3),c&&Da(y,a.aa,g,2),h&&Da(y,a.Gb,p,4),Da(y,a.Xd,f,3)):a.ha[a.R++]=y})}}
function Ga(a){var d=a.Je=[],e=a.vf=[],c=a.aa;if(c){var h=new R,q=new R,r=new R,g=new R,p=new R,m=new R,f=new R,k=new R,n=new R,t=new R,x=new R;a.hl(function(A,K,w,H){var I=H[0],b=H[1];H=H[2];h.M(c,2*I);q.M(c,2*b);r.M(c,2*H);ca(g,K,A);ca(p,w,A);ca(m,q,h);ca(f,r,h);A=1/(m[0]*f[1]-m[1]*f[0]);ca(k,t.f(g).scale(f[1]),x.f(p).scale(m[1])).scale(A);ca(n,t.f(p).scale(m[0]),x.f(g).scale(f[0])).scale(A);k.normalize();n.normalize();Da(I,d,k,3);Da(I,e,n,3);Da(b,d,k,3);Da(b,e,n,3);Da(H,d,k,3);Da(H,e,n,3)});for(var y=
new R,B=new R,z=0;z<a.B;z++)y.M(a.ja,3*z),k.M(a.Je,3*z),n.M(a.vf,3*z),k.td(y,-k.cc(y)).normalize(),0>ea(B,y,k).cc(n)&&k.scale(-1),Da(z,d,k,3)}}
T.Ob.prototype={Nb:{Rk:function(a,d,e,c,h){if(d&&a)for(var q=0;q<e;q++)a[c*e+q]=d[h*e+q]},Qk:function(a,d,e,c){var h=T.Ob.prototype.Nb.Rk;h(a.ka,d.ka,3,e,c);h(a.od,d.od,1,e,c);h(a.ja,d.ja,3,e,c);h(a.aa,d.aa,2,e,c);h(a.Yd,d.Yd,4,e,c);h(a.Zd,d.Zd,4,e,c);h(a.Gb,d.Gb,4,e,c)},zh:function(a,d){var e=new T.Ob;Object.keys(a).forEach(function(c){var h=a[c];Array.isArray(h)&&0<h.length&&(e[c]=[])});if(!a.aa||0< !a.aa.length)e.aa=null;0< !a.ja.length&&(e.ja=null);d||(e.re=a.re);return e},Hp:function(a,d,e){for(var c=
new Map,h=0,q=0,r=0,g=a.length;r<g;r++){var p=T.j.ti(a[r],5);if(c.has(p))m=c.get(p);else{c.set(p,h);var m=h;d[h++]=p}e[q++]=m}},rq:function(a,d,e,c){for(var h=0,q=e.length;h<q;h++)for(var r=0;r<c;r++)a[h*c+r]=d[e[h]*c+r];return a}},cp:function(){var a=new R;return function(d){if(!T.types.fi(d))throw Error();for(var e=this.ka,c=0,h=e.length;c<h;c+=3)ia(a,e[c],e[c+1],e[c+2]),d(a)&&(e[c]=a[0],e[c+1]=a[1],e[c+2]=a[2])}}(),hl:function(){function a(q,r,g){q[r]=g[0];q[r+1]=g[1];q[r+2]=g[2]}var d=new R,e=
new R,c=new R,h=new R;return function(q){if(!T.types.fi(q))throw Error();for(var r=this.ha,g=this.ka,p=0,m=r.length,f=0;p<m;p+=3){var k=r[p],n=r[p+1],t=r[p+2];ia(h,k,n,t);d.M(g,3*k);e.M(g,3*n);c.M(g,3*t);!0===q(d,e,c,h,f)&&(a(g,3*k,d),a(g,3*n,e),a(g,3*t,c),a(r,p,h));f++}}}(),clear:function(){this.B=this.R=0}};T.Hj=function(a,d,e){this.nd=this.yi=this.qd=this.Wa=null;this.R=this.B=0;a&&Ha(this,a,d,e)};
function Ha(a,d,e,c){d instanceof T.Ob&&(d=[d]);var h=a.qd=[];a.yi=e;var q=a.nd=[],r=new Map,g=0;d.forEach(function(f){var k=f.h.$l;k&&k.forEach(function(n){n=n.xi;if(!c||c[n]){if(e&&!e[n])throw console.log("material output for material data is not found: '"+n+"'"),Error();r.has(n)||(r.set(n,g),q[g]=n,h[g]=a.Nb.zh(f,!0),h[g].od=null,h[g].re=null,g++)}})});var p=new Map,m=new Map;d.forEach(function(f){var k=f.ha,n=f.od;p.clear();m.clear();f.h.$l.forEach(function(K,w){if(r.has(K.xi)){var H=r.get(K.xi);
m.set(w,H)}else m.set(w,-1)});for(var t=0;t<f.R;t++){var x=k[t],y=n[x],B=m.get(y);if(!(0>B)){var z=h[B];if(p.has(x))var A=p.get(x);else A=z.B,65500<=A&&0===t%3&&(z=z.Nb.zh(z,!0),z.od=null,z.re=null,A=h.length,q[A]=q[B],h[A]=z,m.set(y,A),p.clear(),A=z.B),z.B++,p.set(x,A),a.Nb.Qk(z,f,A,x);z.ha[z.R++]=A}}});d[0]&&(a.Wa=d[0].Wa);a.qd.forEach(function(f){a.R+=f.R;a.B+=f.B})}T.Hj.prototype={ci:!0,Nb:T.Ob.prototype.Nb,toJSON:function(){return{ci:!0,nd:this.nd,qd:this.qd}}};
T.Eg=function(a,d){this.G=a;this.Cd=this.Ag=this.Bg=this.zg=this.yg=null;this.tg=[];this.ug=[];this.sg=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.Cg=[null,null,null,null,null,null,null,null];this.$e=0;this.kf={};this.Dd="";var e=Ia(this,"WEBGL_debug_renderer_info");e&&(this.Dd=a.getParameter(e.UNMASKED_RENDERER_WEBGL));if(d){console.log("is GL 2");var c=this.kf;"WEBGL_depth_texture OES_texture_float OES_texture_float_linear OES_vertex_array_object OES_standard_derivatives ANGLE_instanced_arrays OES_element_index_uint EXT_frag_depth EXT_blend_minmax EXT_shader_texture_lod WEBGL_draw_buffers".split(" ").forEach(function(h){c[h]=
!0});this.V=!0}else this.V=!1};function Ia(a,d){var e=a.kf[d];void 0===e&&(e=a.G.getExtension(d),a.kf[d]=e);return e?e:null}function Ja(a,d){a.zg!==d&&(a.G.bindBuffer(a.G.ELEMENT_ARRAY_BUFFER,d),a.zg=d)}function Ka(a,d,e,c){a.Cg[e]!==d&&(a.$e!==e&&(a.$e=e,a.G.activeTexture(a.G.TEXTURE0+e)),a.G.bindTexture(c,d),a.Cg[e]=d)}function La(a,d){Ka(a,d,a.$e,a.G.TEXTURE_2D)}function Ma(a,d){a.Ag!==d&&(a.G.bindFramebuffer(a.G.FRAMEBUFFER,d),a.Ag=d)}
function Na(a,d){var e=Ia(a,"OES_vertex_array_object");a.Cd!==d&&(a.V?a.G.bindVertexArray(d):e.bindVertexArrayOES(d),a.Cd=d)}
function Oa(a,d){var e=a.G,c=d.w,h=d.o,q=d.Aa,r=d.xa,g=d.$,p=d.fb,m=d.oc,f=d.Hb,k=d.Ib;if(g===e.FLOAT){if(!Ia(a,"OES_texture_float"))throw Error("float texture not supported.");if((p!==e.NEAREST||m!==e.NEAREST)&&!Ia(a,"OES_texture_float_linear"))throw Error("float texture linear filtering not supported.");a.V&&(q=d.Aa=e.RGBA32F)}else if(36193===g){var n=Ia(a,"OES_texture_half_float");if(!n)throw Error("half float texture not supported.");if(36193!==n.HALF_FLOAT_OES)throw Error("gl.HALF_FLOAT enum different than expected");
if((p!==e.NEAREST||m!==e.NEAREST)&&!Ia(a,"OES_texture_half_float_linear"))throw Error("half float texture linear filtering not suported.");a.V&&(q=d.Aa=e.RGBA16F)}n=e.createTexture();La(a,n);e.texImage2D(e.TEXTURE_2D,0,q||r,c,h,0,r,g,null);p&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,p);m&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,m);f&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,f);k&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,k);return n}
T.Eg.prototype={deleteProgram:function(a){this.Bg===a&&(this.Bg=null);this.G.deleteProgram(a)}};
T.Ua={xh:function(a){return a.slice(0)},pp:function(a,d){if(a.length!==d.length)return!1;for(var e=0,c=a.length;e<c;++e)if(a[e]!==d[e])return!1;return!0},Dl:function(a,d){for(var e=0,c;e<a.length;++e){var h=a[e];for(c=e-1;0<=c&&0<d(a[c],h);--c)a[c+1]=a[c];a[c+1]=h}},Qo:function(a,d){for(var e=-1,c=a.length;1+e!==c;){var h=e+(c-e>>1);d<=a[h]?c=h:e=h}return c},findIndex:function(a,d){for(var e=0,c=a.length;e<c;e++){var h=a[e];if(void 0!==h&&d(h))return e}return-1},indexOf:function(a,d){for(var e=0,
c=a.length;e<c;e++)if(a[e]===d)return e;return-1},cm:function(a,d){var e=a[d];a.splice(d,1);return e},Fo:function(a,d){if(0<=T.Ua.indexOf(a,d))return!1;a.push(d);return!0},em:function(a,d,e){var c=T.Ua.indexOf(a,d);if(0<=c)return T.Ua.cm(a,c),!0;if(e)throw Error("array elem removal failed: elem ["+d+"] does not exist in array");return!1},Ri:function(a,d,e,c){switch(arguments.length){case 2:e=d;d=0;c=1;break;case 3:c=1;break;case 4:if(T.j.sign(c)!==T.j.sign(e-d))return[];break;default:throw Error("incorrect number of arguments");
}var h=0;if(0<c)for(var q=d;q<e;q+=c,h++)a[h]=q;else for(q=d;q>e;q+=c,h++)a[h]=q;return a},bb:function(a,d,e){a.splice(d,0,e)},extend:function(a,d){a.push.apply(a,d)},hq:function(a){for(var d=a.length,e,c;d;)c=Math.floor(Math.random()*d--),e=a[d],a[d]=a[c],a[c]=e;return a}};
T.Xb={aq:function(a,d,e){return a&~(1<<d)|e<<d},Xp:function(a,d){return a>>>d&1},Yp:function(a,d,e){return T.Xb.Ul(a,d,e)>>>d},cq:function(a,d,e){return a|d<<e},bq:function(a,d,e,c){a&=~T.Xb.be(d,e);return a|c<<d},Ul:function(a,d,e){return a&T.Xb.be(d,e)},be:function(a,d){return 32===d&&0===a?-1:~(-1<<d-a)<<a},Sl:function(a){a-=a>>1&1431655765;a=(a&858993459)+(a>>2&858993459);return 16843009*(a+(a>>4)&252645135)>>24},toString:function(a){return a.toString(2)}};
T.j={Pk:function(a,d,e){var c=d-a;return Math.abs(c)<e?d:a+T.j.sign(c)*e},sign:function(a){return 0<a?1:0>a?-1:0},oa:function(a,d,e){return Math.min(Math.max(a,d),e)},pi:function(a,d,e){return a+(d-a)*e},zq:function(a,d,e,c){if(1===c)throw Error();a=d-(d-a)/(1-c);return a+(d-a)*e},Ai:function(a,d){return 0===d?a:(a%d+d)%d},Oo:function(a,d,e,c){var h=1-e;return a*h*h+2*c*h*e+d*e*e},Po:function(a,d,e,c,h){var q=e*e,r=1-e,g=r*r;return a*g*r+3*c*g*e+3*h*r*q+d*q*e},ud:function(a,d){return a+Math.random()*
(d-a)},cg:function(a,d){return Math.floor(a+Math.random()*(d-a+1))},Tp:function(a){return a[Math.floor(Math.random()*a.length)]},Vp:function(a){var d=Math.floor(Math.random()*a.size),e=0;a=a.keys();var c="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];a=c?c.call(a):{next:aa(a)};for(c=a.next();!c.done;c=a.next())if(c=c.value,e++===d)return c},Up:function(a,d){a instanceof R||(a=va().f(a));var e=T.j.ud(Math.cos(d),1),c=T.j.ud(0,2*Math.PI),h=va();ia(h,Math.sqrt(1-e*e)*Math.cos(c),Math.sqrt(1-
e*e)*Math.sin(c),e);if(0===a[0]&&0===a[1])return 0<a[2]||(h[0]=-h[0],h[1]=-h[1],h[2]=-h[2]),h;e=Ca();var q=a;c=R.prototype.qf;var r=va(),g=c.cc(q),p=Math.sqrt(c.cd()*q.cd());-1===g/p?(q=Math.abs(c[0]),g=Math.abs(c[1]),p=Math.abs(c[2]),ea(r,c,q<g?q<p?r.Tg:r.qf:g<p?r.Tg:r.qf),r.normalize(),e=e.zd(r[0],r[1],r[2],0)):(ea(r,c,q),e=e.zd(r[0],r[1],r[2],g+p).normalize());return h.Ya(e)},fg:function(a,d,e,c,h){return c+(a-d)/(e-d)*(h-c)},Rp:function(a,d,e,c){e=Math.sqrt(d*d-4*a*e);return isNaN(e)?-1:(c?Math.min:
Math.max)((-d+e)/(2*a),(-d-e)/(2*a))},Ab:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a},qq:function(a){return Math.PI/180*a},oq:function(a){return 180/Math.PI*a},Qp:function(a,d){return Math.floor(a/d)*d},zp:function(a,d){return Math.ceil(a/d)*d},op:function(a){return 0===a?!1:0===(a&a-1)},ti:function(a,d){return parseFloat(a.toFixed(d))},Pp:function(a,d){var e=Math.cos(d),c=Math.sin(d);return ia(va(),a*e,a*c,0)},nh:function(a,d){return a/((1/d-2)*(1-a)+1)},gain:function(a,
d){return.5>a?T.j.nh(2*a,d)/2:T.j.nh(2*a-1,1-d)/2+.5}};T.Zb={};
(function(){function a(){this.length=0;this.W=[];this.map=new Map;this.gd=new Map}var d=T.Zb;a.prototype.bb=function(e,c){var h=this.length;this.W[h]=c;this.length++;this.map.set(e,h);this.gd.set(c,e)};a.prototype.has=function(e){return this.map.has(e)};a.prototype.get=function(e){return this.W[this.map.get(e)]};a.prototype.remove=function(e){var c=this.map.get(e),h=this.W[c],q=this.W[this.length-1];this.W[c]=q;this.W[this.length-1]=null;this.length--;var r=this.gd.get(q);this.map.set(r,c);this.gd.set(q,
r);this.map["delete"](e);this.gd["delete"](h);return h};a.prototype.forEach=function(e){for(var c=0,h=this.length;c<h;c++)e(this.W[c],c,this)};a.prototype.clear=function(){this.length=0;this.W.length=0;this.map.clear();this.gd.clear()};d.Pn=a;d.Jj=function(e,c){this.Ae=[];this.Ra=[];this.bg=e;this.dm=c||this.Wk};d.Jj.prototype={update:function(e,c){for(var h=this.Ae,q=0,r=h.length;q<r;q++){var g=h[q];g.update(e,c);this.dm(g)&&(h[q]=h[r-1],r--,q--,this.Ra.push(g))}h.length=r},Mf:function(e){var c=
0<this.Ra.length?this.Ra.pop():new this.bg;c.mc&&c.mc.apply(c,e);this.Ae.push(c);return c},clear:function(){for(;0<this.Ae.length;)this.Ra.push(this.Ae.pop())},Wk:function(e){return!e.xk}};d.cf=function(e){this.za=new Map;this.W=[];this.length=0;this.jc=e||this.zj};d.cf.prototype={zj:function(e){return e},bb:function(e){var c=this.jc(e);if(!this.za.has(c)){var h=this.length;this.W[h]=e;this.za.set(c,h);this.length++}},remove:function(e){e=this.jc(e);if(this.za.has(e)){var c=this.za.get(e);this.length--;
var h=this.W[this.length];this.W[c]=h;h=this.jc(h);this.za.set(h,c);this.za["delete"](e)}},has:function(e){return this.za.has(this.jc(e))},forEach:function(e){for(var c=this.W,h=this.length,q=0;q<h;q++)e(c[q],q,c)}};d.Jc=function(e){this.bg=e;this.Ra=[];d.cf.call(this,void 0)};d.Jc.prototype=Object.create(d.cf.prototype);d.Jc.prototype.update=function(e,c){for(var h=this.W,q=this.length,r=0;r<q;r++){var g=h[r];g.update(e,c);g.xk||(this.za["delete"](this.jc(g)),this.Ra.push(g),r<q-1&&(g=h[q-1],h[r]=
g,this.za.set(this.jc(g),r)),q--,r--)}this.length=q};d.Jc.prototype.Mf=function(e){var c=0<this.Ra.length?this.Ra.pop():new this.bg;c.mc&&c.mc.apply(c,e);this.bb(c);return c};d.Jc.prototype.bm=function(e){if(!this.za.has(e))throw Error();this.remove(e);this.Ra.push(e)};d.Qb=function(e){this.Za=e||this.Vk;this.root=null;this.Vg=this.Zf(this.Fg)};d.Qb.prototype={eg:[],Fg:new function(){},Zf:function(e){if(0<this.eg.length){var c=this.eg.pop();c.red=!0;c.item=e;c.left=null;c.right=null;return c}return new this.Node(e)},
release:function(e){this.eg.push(e);e.item=this.Fg},rotate:function(e,c){var h=e.I(!c);e.sa(!c,h.I(c));h.sa(c,e);e.red=!0;h.red=!1;return h},Bh:function(e,c){e.sa(!c,this.rotate(e.I(!c),!c));return this.rotate(e,c)},S:function(e){return null!==e&&e.red},assert:function(e){void 0===e&&(e=this.root);if(null===e)return 1;var c=e.left,h=e.right;if(this.S(e)&&(this.S(c)||this.S(h)))return console.log("Red violation"),0;var q=this.assert(c);var r=this.assert(h);return null!==c&&0>=this.Za(c.item,e.item)||
null!==h&&0<=this.Za(h.item,e.item)?(console.log("Binary tree violation"),console.log(c.item,e.item,h.item),0):0!==q&&0!==r&&q!==r?(console.log("Black violation"),0):0!==q&&0!==r?this.S(e)?q:q+1:0},bb:function(e){if(null===this.root)this.root=this.Zf(e);else{var c=this.Vg,h=!1,q=c,r;var g=r=null;q.sa(!0,this.root);for(var p=this.root;;){null===p?(p=this.Zf(e),r.sa(h,p)):this.S(p.left)&&this.S(p.right)&&(p.red=!0,p.left.red=!1,p.right.red=!1);if(this.S(p)&&this.S(r)){var m=q.right===g;p===r.I(f)?q.sa(m,
this.rotate(g,!f)):q.sa(m,this.Bh(g,!f))}m=this.Za(p.item,e);if(0===m)break;var f=h;h=0<m;null!==g&&(q=g);g=r;r=p;p=p.I(h)}this.root=c.right}this.root.red=!1},remove:function(e){var c=null;if(null!==this.root){var h=this.Vg,q=null,r=!0;var g=h;var p=null;for(g.right=this.root;null!==g.I(r);){var m=r;var f=p;p=g;g=g.I(r);var k=this.Za(g.item,e);r=0<k;0===k&&(q=g);if(!this.S(g)&&!this.S(g.I(r)))if(this.S(g.I(!r)))f=this.rotate(g,r),p.sa(m,f),p=f;else if(!this.S(g.I(!r))&&(k=p.I(!m),null!==k))if(this.S(k.I(!m))||
this.S(k.I(m))){var n=f.right===p;this.S(k.I(m))?f.sa(n,this.Bh(p,m)):this.S(k.I(!m))&&f.sa(n,this.rotate(p,m));g.red=f.I(n).red=!0;f.I(n).left.red=!1;f.I(n).right.red=!1}else p.red=!1,k.red=!0,g.red=!0}null!==q&&(c=q.item,q.item=g.item,p.sa(p.right===g,g.I(null===g.left)),this.release(g));this.root=h.right;null!==this.root&&(this.root.red=!1)}return c},contains:function(e){for(var c=this.root;null!==c;){var h=this.Za(c.item,e);if(0===h)return!0;c=0<h?c.right:c.left}return!1},vl:function(e){for(var c=
this.root;null!==c;){var h=this.Za(c.item,e);if(0===h)return c.item;c=0<h?c.right:c.left}return null},empty:function(){for(var e=this.root,c;null!==e;)null!==e.left?(c=e.left,e.left=c.right,c.right=e):(c=e.right,this.release(e)),e=c;this.root=null},Vk:function(e,c){return e===c?0:c>e?1:-1},ei:function(){return null===this.root}};d.Qb.prototype.Node=function(e){this.item=e;this.red=!0;this.right=this.left=null};d.Qb.prototype.Node.prototype={I:function(e){return e?this.right:this.left},sa:function(e,
c){e?this.right=c:this.left=c}};d.Ja=function(){d.Qb.call(this,this.vh)};d.Ja.prototype=Object.create(d.Qb.prototype);d.Ja.prototype.ai=function(e,c){var h=this.createRange(e,c);for(this.Za=this.Ok;this.contains(h);){var q=this.remove(h);h[0]=Math.min(q[0],h[0]);h[1]=Math.max(q[1],h[1]);this.Fe(q)}this.Za=this.vh;this.bb(h)};d.Ja.prototype.dg=[];d.Ja.prototype.createRange=function(e,c){var h=0<this.dg.length?this.dg.pop():[];h[0]=e;h[1]=c;return h};d.Ja.prototype.Fe=function(e){this.dg.push(e)};d.Ja.prototype.removeRange=
function(e,c){for(var h=this.createRange(e,c);this.contains(h);){var q=this.remove(h),r=this.createRange(Math.max(h[1]),q[1]);q[1]=Math.min(q[1],h[0]);q[1]>q[0]?this.bb(q):this.Fe(q);r[1]>r[0]?this.bb(r):this.Fe(r)}this.Fe(h)};d.Ja.prototype.vh=function(e,c){return c[1]<=e[0]?-1:c[0]>=e[1]?1:0};d.Ja.prototype.Ok=function(e,c){return c[1]<e[0]?-1:c[0]>e[1]?1:0};d.hf=function(){this.elements=[];this.Y=[];this.length=0};d.hf.prototype={Fh:function(e,c){if(void 0===c)throw Error("elems must be put in BinaryHeap with priority");
this.elements.push(e);this.Y.push(c);this.Ik(this.elements.length-1);this.length+=1;return e},Ef:function(){var e=this.elements[0],c=this.elements.pop(),h=this.Y.pop();0<this.elements.length&&(this.elements[0]=c,this.Y[0]=h,this.mm(0));--this.length;return e},Ji:function(){return this.Y[0]},contains:function(e){return 0<=T.Ua.indexOf(this.elements,e)},fj:function(e,c){var h=this.elements[c],q=this.Y[c];this.elements[c]=this.elements[e];this.Y[c]=this.Y[e];this.elements[e]=h;this.Y[e]=q},Ik:function(e){for(var c=
this.Y[e];0<e;){var h=Math.floor((e+1)/2)-1;if(c>=this.Y[h])break;this.fj(e,h);e=h}},mm:function(e){for(var c=this.elements.length,h=this.Y[e];;){var q=2*(e+1),r=q-1,g=null;if(q<c){var p=this.Y[q];p<h&&(g=q)}r<c&&this.Y[r]<(null===g?h:p)&&(g=r);if(null===g)break;this.fj(g,e);e=g}},clear:function(){this.length=0;this.elements.length=0;this.Y.length=0;return this},ei:function(){return 0===this.length}};d.Mj=function(){this.Ke=[];this.stack=[];this.length=0};d.Mj.prototype={Fh:function(e){this.Ke.push(e);
this.length+=1},Ef:function(){if(0===this.stack.length)for(;0<this.Ke.length;)this.stack.push(this.Ke.pop());--this.length;return this.stack.pop()},clear:function(){this.Ke.length=0;this.length=this.stack.length=0}}})();T.Rb=[];
T.Rb.push(function(a,d){var e=null;d.On=function(){function q(k){m=k/1E3;p=requestAnimationFrame(r)}function r(k){k/=1E3;var n=k-m;n=Math.min(n,.05);0>n&&(n=0);0<n&&(e.Yf=100*n+.9*e.Yf,e.il=1E3/e.Yf);m=k;e.wk=n;e.Fl&&(n=0);e.$c=n;k=e.time+n;e.time=k;for(g+=n;g>=e.wc;){g-=e.wc;e.frame+=1;var t=e.frame*e.wc;d.Sk(e.wc,t);e.Kh&&e.Kh(e.wc,t)}d.Oa.elapsedTime=k;d.Oa.Pg[0]=k;e.Lh&&e.Lh(n,k);p=requestAnimationFrame(r)}if(e)return e;e={il:60,Yf:1E3/60,wc:1/60,frame:0,time:0,Kh:null,Lh:null,ne:!1,Fl:!1,$c:0,
wk:0};(function(){for(var k=0,n=["webkit","moz"],t=0;t<n.length&&!window.requestAnimationFrame;++t)window.requestAnimationFrame=window[n[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[t]+"CancelAnimationFrame"]||window[n[t]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(x){var y=(new Date).getTime(),B=Math.max(0,16-(y-k)),z=window.setTimeout(function(){x(y+B)},B);k=y+B;return z});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(x){clearTimeout(x)})})();var g=0,p=-1,m=0,f=1/60;e.start=function(k){k||(k=60);k=1/k;if(!e.ne){void 0===k&&(k=f);e.wc=k;if(!T.types.Bb(k)||0>=k)throw new TypeError("Cant start _loop, stepSize is invalid: "+k);requestAnimationFrame(q);e.ne=!0}};e.pause=function(){e.ne&&(cancelAnimationFrame(p),e.ne=!1)};return e};var c=null;a.fn=function(q){function r(p,m,f){m=m.split(" ");for(var k=m.length;k--;)p.addEventListener(m[k],f,!1)}if(c)return c;if(!(q instanceof HTMLElement))throw Error("curs must bind to a valid HTMLElement");
c={x:0,y:0,hi:!1,di:!1,ni:0,oi:0,mi:0,Mk:0,Nk:0,uh:0,dc:0,ec:0,duration:0,button:0,wheelDelta:0,xf:[],zk:!1,ld:!1,de:0,tc:!1,uk:0,Ao:!1,Xg:!1,Cp:null,Dp:null,Ep:null,Fi:null,Fj:1,Nn:2,Pj:3,Ck:function(p){r(q,"touchstart, mousedown",p)},Ek:function(p){r(q,"touchend mouseup touchcancel",p)},Dk:function(p){r(q,"touchmove mousemove",p)},Fk:function(p){r(q,"DOMMouseScroll mousewheel",p)}};r(q,"contextmenu click",function(p){p.preventDefault()});r(q,"mouseout",function(p){LOGGER&&LOGGER.log("Mouse left Window");
p.preventDefault()});r(q,"mouseover ",function(p){LOGGER&&LOGGER.log("Mouse enter Window");p.preventDefault()});r(document,"pointerlockchange",function(p){c.ld=document.pointerLockElement===q||document.up===q||document.Aq===q;c.dc=0;c.ec=0;c.Ci=0;c.Di=0;c.ld?(c.uk=2,g&&!g.Md&&(g.x=c.x,g.y=c.y,g.x=T.j.oa(g.x,0,q.width),g.y=T.j.oa(g.y,0,q.height)),g&&(g.lb.yd(!g.Md),g.ij())):(c.ni=c.x,c.oi=c.y,g&&g.lb.yd(!1));c.tc=!1;LOGGER.log("pointer lock state is now "+(c.ld?"true":"false"));p.preventDefault()});
r(document,"pointerlockerror",function(p){c.tc=!1;LOGGER.log("pointer lock denied");p.preventDefault()});c.Ck(function(p){p.preventDefault();p.stopPropagation();!c.de||c.Pd()||c.tc?(c.button=p.which,c.xf[c.button]=!0,c.hi=!0,c.dc=0,c.ec=0,c.duration=p.timeStamp-c.uh,c.di=200>=c.duration&&!1===c.di,c.mi=p.timeStamp,c.uh=p.timeStamp,c.Mk=c.x,c.Nk=c.y,c.ni=c.x,c.oi=c.y):c.Ki()});c.Ek(function(p){p.preventDefault();c.button=p.which;c.xf[c.button]=!1;c.dc=0;c.ec=0;c.hi=c.xf.some(function(m){return m})});
c.Dk(function(p){p.preventDefault();var m=q.getBoundingClientRect();c.x=p.clientX-m.left;c.y=p.clientY-m.top;c.Pd()||(c.Zg=p.clientX,c.$g=p.clientY);if(c.de&&!c.Pd()&&!c.tc&&c.Xg)c.Xg=!1,c.Ki();else if(c.Pd()&&c.de){c.dc=0;c.ec=0;if(0!==p.movementX||0!==p.movementY){c.Zg+=p.movementX;c.$g+=p.movementY;m=p.movementX/1.5;var f=p.movementY/1.5,k=!1;void 0!==c.Oi&&0>c.Oi*m&&30<Math.abs(p.movementX)&&(k=!0);void 0!==c.Pi&&0>c.Pi*f&&30<Math.abs(p.movementY)&&(k=!0);k&&(f=m=0,LOGGER.log("prevented probably faulty detected mouse movement: "+
p.movementX.toFixed(0)+","+p.movementY.toFixed(0)));c.Ci=m;c.Di=f;c.dc=m;c.ec=f;c.duration=p.timeStamp-c.mi;c.Oi=m;c.Pi=f}g&&!g.Md&&(m=q.getBoundingClientRect(),p=m.width,m=m.height,g.Ac+=c.dc/p,g.Cc+=c.ec/m,g.Ac=T.j.oa(g.Ac,0,1),g.Cc=T.j.oa(g.Cc,0,1),g.x=g.Ac*p,g.y=g.Cc*m,c.x=g.x,c.y=g.y,c.Ci=0,c.Di=0,g.ij())}});c.Fk(function(p){p.preventDefault();p=p.detail?-120*p.detail:p.wheelDelta;c.wheelDelta=p;0!==p&&c.Fi&&c.Fi(p)});c.Ki=function(){q.requestPointerLock||(q.requestPointerLock=q.requestPointerLock||
q.vp);c.de=1;c.zk&&!c.tc&&(LOGGER.log("enabling lock..."),q.requestPointerLock(),c.tc=!0)};c.np=function(){return c.ld&&(!g||g.Md)};c.Pd=function(){return c.ld};var g=null;c.yq=function(p,m){g||(g={lb:p,$h:m.rect,Ac:.5,Cc:.5,x:m.rect[2]/2,y:m.rect[3]/2,Md:!1,ij:function(){var f=g.lb;ia(f.c,g.Ac*g.$h[2],g.Cc*g.$h[3],0);f.Ca()}},g.lb.yd(!1),c.zo=g);ia(g.lb.c,400,300,0);g.lb.km(32*m.rect[2]/m.rect[3]);g.lb.Ca();return g.lb};return c};var h=null;a.Kn=function(q){if(h)return h;var r=[],g=[];h={key:-1,
Mi:-1,Xk:100,Ni:0,Ee:-1,Ge:null,Tf:!1,oe:new Map,Dm:65,Zm:66,cn:67,gn:68,E:69,qn:70,Dn:71,En:72,Gn:73,In:74,Jn:75,Ln:76,Mn:77,Rn:78,Tn:79,Vn:80,Q:81,Yn:82,Zn:83,fo:84,no:85,uo:86,vo:87,wo:88,xo:89,yo:90,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,ln:13,ao:32,ho:9,pn:27,an:8,Fj:37,oo:38,Pj:39,jn:40,$n:16,en:17,Em:18,dn:20,Sn:144,$m:192,Hn:45,hn:46,Fn:36,kn:35,Xn:33,Wn:34,rn:112,vn:113,wn:114,xn:115,yn:116,zn:117,An:118,Bn:119,Cn:120,sn:121,tn:122,un:123,Lo:function(p){r.push(p)},Mo:function(p){g.push(p)},
qp:function(p){return keyboardMap[p]}};q.addEventListener("keydown",function(p){p.preventDefault();p.stopPropagation();var m=p.timeStamp,f=p.keyCode;if(h.Ge&&(f=h.Ge[f],void 0===f))return;h.Mi=h.key;h.key=f;h.rp=p.key;h.code=p.keyCode;h.oe.set(f,!0);f===h.Mi&&h.Ee===f&&m-h.Ni<h.Xk?(h.Tf=!0,h.Ee=-1):h.Tf=!1;p=0;for(m=r.length;p<m;p++)r[p](h.key,h.Tf)},!1);q.addEventListener("keyup",function(p){p.preventDefault();p.stopPropagation();var m=p.keyCode;if(h.Ge&&(m=h.Ge[m],void 0===m))return;h.Ee=m;h.Ni=
p.timeStamp;h.oe.set(m,!1);p=0;for(m=g.length;p<m;p++)g[p](h.Ee)},!1);h.mp=function(p){return h.oe.has(p)&&!0===h.oe.get(p)};return h}});
T.Rb.push(function(a,d){function e(f){this.kc=new Uint16Array(f);this.Eh=g.createBuffer();this.xb=f;this.hg=!0;this.Vc=-1}function c(f,k,n,t,x,y,B){this.wa=f;this.pg=k;this.ab=n;this.Oe=y;this.xb=B;this.kj=y;this.ke=B}function h(){this.jb=this.next=null}function q(f){h.call(this);this.size=f;this.lc=[]}function r(f){this.Ff=(new q(-1)).Bk();this.Ne=0;this.zi=f||-1;this.qe=-1}var g=d.G,p=d.Of,m=d.pb;a.xg=function(){this.tf=[];this.uf=[];this.X={};this.Ud=0;this.vm=!0};a.xg.prototype={Pl:function(f,
k,n,t,x,y,B,z){var A={};A.wl=k;A.qa=n;A.yl=0<=B?B:0;A.xl=0<=y?y:0;A.ie=void 0!==x?x:!1;A.bi=0;A.$k=!1;A.Gc=void 0!==t?t:Float32Array;switch(A.Gc){case Float32Array:A.ic=g.FLOAT;break;case Uint8ClampedArray:A.ic=g.UNSIGNED_BYTE;break;case Uint8Array:A.ic=g.UNSIGNED_BYTE;break;case Int8Array:A.ic=g.BYTE;break;case Uint16Array:A.ic=g.UNSIGNED_SHORT;break;case Uint32Array:A.ic=g.UNSIGNED_INT;break;default:throw Error();}if(void 0!==this.X[z])if(console.log("shared buffer?"),f=this.X[z],0<=f)A.Xf=this[f].Xf;
else throw Error();else k=this.Ud,A.Xf=k,this[k]=A,this.tf.push(k),this.X[f]=k,this.Ud++;this.uf.push(A);return this},Ml:function(){this.uf.forEach(function(f){f.$k=!0})},ol:function(){for(var f=[],k=0;k<this.Ud;k++)f.push(this[k].wl);return f}};a.Dg=function(f){this.D=f;f=new a.Ze(f);this.Wf=[f];this.Uf=f};a.Dg.prototype={wd:function(f,k){var n=this.Uf.wd(f,k);if(null===n)for(var t=0,x=this.Wf.length;t<x;t++){var y=this.Wf[t];n=y.wd(f,k);if(null!==n){this.Uf=y;break}}if(null===n&&(y=new a.Ze(this.D),
this.Wf.push(y),this.Uf=y,n=y.wd(f,k),null===n))throw Error();if(null===n)throw Error();return n}};a.Ze=function(f){this.D=f;this.Ga=[];this.Xh=[];this.Af=[];this.h={fm:!1,gm:!0};this.Oe=0;this.bh(f,0);this.og=new r(this.df);f.vm&&(this.yb=new e(0),this.fd=new r(-1));this.fe=new d.Zb.Ja;this.sf=new Set;if(Ia(p,"OES_vertex_array_object")){var k=Ia(p,"OES_vertex_array_object");if(k){k=p.V?p.G.createVertexArray():k.createVertexArrayOES();Na(p,k);k=0;for(var n=f.Ud;k<n;k++){var t=f.uf[k],x=p,y=this.Xh[t.Xf],
B=k,z=x,A=B;if(z.Cd||!z.tg[A])z.G.enableVertexAttribArray(A),z.tg[A]=!0;if(x.Cd||x.ug[B]!==y)z=x,A=y,z.yg!==A&&(z.G.bindBuffer(z.G.ARRAY_BUFFER,A),z.yg=A),x.G.vertexAttribPointer(B,t.qa,t.ic,t.ie,t.yl,t.xl),x.ug[B]=y;x.sg[B]!==t.bi&&(x.sg[B]=t.bi)}this.yb&&this.yb.qm();Na(p,null)}}};a.Ze.prototype={df:65535,bh:function(f,k){var n=this.Ga,t=this.Xh,x=this.Af;if(k>this.df)throw Error();this.Oe=k;for(var y=0,B=f.tf.length;y<B;y++){var z=f.tf[y],A=f[z];A=new A.Gc(k*A.qa);if(z<n.length)for(var K=n[z],
w=0,H=K.length;w<H;w++)A[w]=K[w];n[z]=A;t[z]||(t[z]=g.createBuffer());x[z]=-1}this.h.fm=!0},Pa:function(f,k,n){var t=this.Oe;k=Math.floor(32*k/t);n=Math.ceil(32*n/t);this.h.gm=!0;this.Af[f]|=d.Xb.be(k,n)},ki:function(f){return 0<=this.D.X[f]},Ug:new Float32Array(4),rk:new R,qk:new P,ym:function(f,k,n,t,x){var y=f.Eb,B=f.usage;if(0!==B){if(0!==(B&d.pb.Hd)){var z=f.jj;y.ii?this.wm(m.Va+z,n.aa,t,y):this.Ia(m.Va+z,n.aa,t)}B&=d.pb.Vj;if(0!==B&&this.ki(m.wg+k)){if(!y.ii)throw Error();n=this.Ug;n[0]=y.Ha;
n[1]=y.Sa;n[2]=y.nb-y.Ha;n[3]=y.Fb-y.Sa;this.Dc(m.wg+k,n,t,x)}B=f.usage;z=B&m.Ld;if(0!==z)if(n=this.Ug,B=f.Jp,f=f.Kp,z===m.Ed){f=y.ze;if(1>=f)throw Error();y=y.nb-y.Ha;n[0]=y/B;n[1]=0;n[2]=y;n[3]=y/f;this.Dc(m.Ec+k,n,t,x)}else if(z===m.Ic||z===m.bf)n[0]=y.Ha,n[1]=y.Sa,n[2]=y.nb,n[3]=y.Fb,z===m.Ic&&(n[2]-=y.Ha,n[3]-=y.Sa),this.Dc(m.Kb+k,n,t,x),n[0]=0!==B?(y.nb-y.Ha)/B:0,n[1]=0!==f?(y.Fb-y.Sa)/f:0,this.Dc(m.Ec+k,n,t,x);else throw Error();}},Pe:function(f,k,n,t,x,y,B){if(f.wa!==this)throw Error();var z=
this,A=f.pg,K=f.ab,w=k.B||k.ka.length/3,H=k.R||k.ha.length,I=d.pb;if(w>f.kj)throw Error();if(H>f.ke)throw Error();B?(z.Bm(I.ba,A,k.ka,k.Zd,k.Yd,B),z.Ia(I.Lb,k.ja,A)):y?(z.pj(I.ba,k.ka,A,y),z.pj(I.Lb,k.ja,A,y,!0)):(z.Ia(I.ba,k.ka,A),z.Ia(I.Lb,k.ja,A));n.i.forEach(function(b,l){z.ym(b,l,k,A,w)});z.Ia(I.Se,k.Xd,A);z.Ia(I.Ve,k.Je,A);z.Ia(I.qj,k.vf,A);if(n.Ta)if(n.Ta.length)z.Dc(I.We,n.Ta,A,w);else if(k.Gb)z.Ia(I.We,k.Gb,A);else throw Error();if(n.ta)if(n.ta.length)z.Dc(I.Xe,n.ta,A,w);else if(k.lj)z.Ia(I.Xe,
k.lj,A);else throw Error();0<=t?z.Am(I.vg,t,A,w):x&&(z.xm(I.Te,k.Yd,A,x),z.Ia(I.Ue,k.Zd,A));k.ha&&(z.yb.zm(k.ha,K,A),f=f.ke,0<f-H&&z.yb.Cm(K+k.R,f-H))},Ia:function(f,k,n){f=this.D.X[f];if(0<=f){for(var t=this.Ga[f],x=this.D[f].qa,y=n*x,B=k.length,z=0;z<B;z++)t[y+z]=k[z];this.Pa(f,n,n+B/x|0)}},Bm:function(f,k,n,t,x,y){f=this.D.X[f];var B=this.rk,z=this.qk;if(!(0<=f))throw Error();var A=this.Ga[f],K=this.D[f].qa;if(3!==K)throw Error();for(var w=k*K,H=n.length/3,I=t.length/H,b=0;b<H;b++){B.M(n,3*b);
for(var l=0;16>l;l++)z[l]=0;for(l=0;l<I;l++){var u=b*I+l;z.td(y[x[u]],t[u])}fa(B,z);A[w+b*K]=B[0];A[w+b*K+1]=B[1];A[w+b*K+2]=B[2]}this.Pa(f,k,k+H|0)},pj:function(f,k,n,t,x){f=this.D.X[f];var y=va();if(0<=f){var B=this.Ga[f],z=this.D[f].qa;if(3!==z)throw Error();for(var A=n*z,K=k.length,w=0;w<K;){y.M(k,w);if(x){var H=y,I=t,b=H[0],l=H[1],u=H[2];H[0]=I[0]*b+I[4]*l+I[8]*u;H[1]=I[1]*b+I[5]*l+I[9]*u;H[2]=I[2]*b+I[6]*l+I[10]*u}else fa(y,t);B[A+w++]=y[0];B[A+w++]=y[1];B[A+w++]=y[2]}this.Pa(f,n,n+K/z|0)}},
wm:function(f,k,n,t){var x=d.j.pi;f=this.D.X[f];if(0<=f){var y=t.Ha,B=t.nb,z=t.Sa,A=t.Fb;1<t.ze&&(B=x(y,B,1/t.ze));var K=this.Ga[f],w=this.D[f].qa,H=n*w,I=k.length;if(1===t.w&&1===t.o)for(k=(y+B)/2,x=(z+A)/2,t=0;t<I;)K[H+t++]=k,K[H+t++]=x;else for(t=0;t<I;t+=2)K[H+t]=x(y,B,k[t]),K[H+t+1]=x(z,A,k[t+1]);this.Pa(f,n,n+I/w|0)}else throw Error();},Am:function(f,k,n,t){f=this.D.X[f];if(0<=f){for(var x=this.Ga[f],y=n*this.D[f].qa,B=0;B<t;B++)x[y+B]=k;this.Pa(f,n,n+t|0)}},Dc:function(f,k,n,t){f=this.D.X[f];
if(0<=f){var x=this.Ga[f],y=this.D[f].qa;if(y!==k.length)throw Error();for(var B=n*y,z=(n+t)*y|0;B<z;)for(var A=0;A<y;A++)x[B++]=k[A];this.Pa(f,n,n+t|0)}},xm:function(f,k,n,t){f=this.D.X[f];if(0<=f){for(var x=this.Ga[f],y=this.D[f].qa,B=n*y,z=0,A=k.length;z<A;z++)x[B+z]=t[k[z]].Yb;this.Pa(f,n,n+k.length/y|0)}else throw Error();},Qe:function(f,k,n){f=this.D.X[f];if(0<=f){for(var t=this.Ga[f],x=this.D[f].qa,y=k*x,B=0;B<x;B++)t[y+B]=n[B];this.Pa(f,k,k+1)}else throw Error();},ob:function(f,k,n,t,x){f=
this.D.X[f];if(0<=f){var y=this.Ga[f],B=this.D[f].qa;if(3!==B)throw Error();B*=k;y[B]=n;y[B+1]=t;y[B+2]=x;this.Pa(f,k,k+1)}else throw Error();},wd:function(f,k){var n=this.og.dh(f),t=this.og.qe;if(0>n)return null;if(this.fd){var x=this.fd.dh(k);if(0>x)return null;var y=this.fd.qe}else x=n,y=t;t=new c(this,n,x,t,y,t,y);this.fe.ai(t.ab,t.ab+t.xb);this.sf.add(t);n+f>this.Oe&&this.bh(this.D,Math.min(d.j.Ab(n+f),this.df));this.yb&&x+k>this.yb.xb&&this.yb.bl(d.j.Ab(x+k));return t},kl:function(f){if(!this.sf.has(f))throw Error();
this.sf["delete"](f);this.fe.removeRange(f.ab,f.ab+f.ke);this.og.Nh(f.kj,f.pg);this.fd&&this.fd.Nh(f.ke,f.ab)}};e.prototype.tm=function(){var f=this.Vc;this.Vc=0;if(0!==f){Ja(p,this.Eh);var k=this.kc;if(this.hg)g.bufferData(g.ELEMENT_ARRAY_BUFFER,k,g.STATIC_DRAW),this.hg=!1;else if(8<=d.Xb.Sl(f))g.bufferSubData(g.ELEMENT_ARRAY_BUFFER,0,k);else for(var n=k.length,t=0;32>t;t++)if(f>>>t&1){var x=Math.floor(t/32*n);g.bufferSubData(g.ELEMENT_ARRAY_BUFFER,x*k.BYTES_PER_ELEMENT,k.subarray(x,Math.ceil((t+
1)/32*n)))}}};e.prototype.zm=function(f,k,n){void 0===k&&(k=0);void 0===n&&(n=0);for(var t=this.kc,x=f.length,y=0;y<x;y++)t[k+y]=f[y]+n;this.wi(k,x)};e.prototype.bl=function(f){if(f<this.xb)throw Error();for(var k=new Uint16Array(f),n=0,t=this.kc.length;n<t;n++)k[n]=this.kc[n];this.kc=k;this.hg=!0;this.Vc=-1;this.xb=f};e.prototype.qm=function(){Ja(p,this.Eh);this.tm()};e.prototype.Cm=function(f,k){for(var n=this.kc,t=0;t<k;t++)n[f+t]=0;this.wi(f,k)};e.prototype.wi=function(f,k){var n=this.xb;this.Vc|=
d.Xb.be(Math.floor(32*f/n),Math.ceil(32*(f+k)/n))};c.prototype={};h.prototype={Bk:function(){this.next=this;this.jb=this;return this},insertBefore:function(f){f.next=this;f.jb=this.jb;this.jb=this.jb.next=f},removeNode:function(){this.jb.next=this.next;this.next.jb=this.jb},Ih:function(f){for(var k=this.next;k!==this;){if(f(k))return k;k=k.next}return null}};q.prototype=Object.create(h.prototype);r.prototype={dh:function(f){if(!f)throw Error();var k=this.Ff.Ih(function(t){return f<=t.size}),n=-1;
if(null===k||.8*k.size>=f){if(0<this.zi&&this.Ne+f>=this.zi)return-1;n=this.Ne;this.qe=f;this.Ne+=f;return n}n=k.lc.pop();0===k.lc.length&&k.removeNode();this.qe=k.size;return n},Nh:function(f,k){var n=this.Ff.Ih(function(x){return f<=x.size});if(null===n)n=new q(f),n.lc.push(k),this.Ff.insertBefore(n);else if(n.size===f)n.lc.push(k),d.Ua.Dl(n.lc,function(x,y){return y-x});else{var t=new q(f);t.lc.push(k);n.insertBefore(t)}}};d.Cj=function(f,k){new T.Kc(new P,new P);this.dl=[];for(var n=0;6>n;n++)this.dl[n]=
new d.Hc(f,k);this.w=f;this.o=k};d.Cj.prototype={nn:[new R(1,0,0),new R(-1,0,0),new R(0,1,0),new R(0,-1,0),new R(0,0,1),new R(0,0,-1)],on:[new R(0,-1,0),new R(0,-1,0),new R(0,0,1),new R(0,0,-1),new R(0,-1,0),new R(0,-1,0)]};d.Hc=function(f,k){d.Hc.prototype.pk.push(this);this.Nf=g.createFramebuffer();this.Ma=this.$a=this.Yc=this.Wc=null;this.jd=!1;if(f instanceof a.qb||k instanceof a.qb)f&&(this.w=f.w,this.o=f.o,this.ih(f)),k&&(this.w=k.w,this.o=k.o,this.jh(k)),this.verify();else if(null!==f||null!==
k)this.w=f,this.o=k,this.Ma=this.$a=null};d.Hc.prototype={pk:[],xd:function(f,k){E.types.Bb(f)&&E.types.Bb(k)?(this.w=f,this.o=k,this.$a?(this.$a.Rc(f,k),this.ih(this.$a)):this.Wc&&(g.deleteRenderbuffer(this.Wc),this.Wc=null),this.Ma?(this.Ma.Ak(f,k),this.jh(this.Ma)):this.Yc&&(g.deleteRenderbuffer(this.Yc),this.Yc=null),this.jd=!1,this.verify()):console.log("change buffer size failed, invalid w,h",f,k)},ih:function(f){if(f.yc&&f.yc!==f.Lg)throw Error();var k=f.L||f;this.jd=!1;this.$a=f;Ma(p,this.Nf);
g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,k,0);return this},jh:function(f){if(f.yc&&f.yc!==f.Mg)throw Error();var k=f.L||f;this.jd=!1;this.Ma=f;Ma(p,this.Nf);if(f.xa===g.RGBA&&f.$===g.UNSIGNED_BYTE){if(this.$a)throw Error();g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,k,0)}else f.Aa===g.DEPTH_STENCIL?g.framebufferTexture2D(g.FRAMEBUFFER,g.DEPTH_STENCIL_ATTACHMENT,g.TEXTURE_2D,k,0):g.framebufferTexture2D(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.TEXTURE_2D,
k,0);return this},verify:function(){if(!this.jd){Ma(p,this.Nf);if(null===this.$a&&null===this.Ma)throw document.title="FBO verification failed",Error();if(this.Ma&&this.Ma.xa===g.RGBA||!this.Ma&&!this.Yc){var f=g.createRenderbuffer();g.bindRenderbuffer(g.RENDERBUFFER,f);g.renderbufferStorage(g.RENDERBUFFER,g.DEPTH_COMPONENT16,this.w,this.o);g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,f);this.Yc=f}else this.$a||this.Wc||(f=g.createRenderbuffer(),g.bindRenderbuffer(g.RENDERBUFFER,
f),g.renderbufferStorage(g.RENDERBUFFER,g.RGBA4,this.w,this.o),g.framebufferRenderbuffer(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.RENDERBUFFER,f),this.Wc=f);if(g.checkFramebufferStatus(g.FRAMEBUFFER)!==g.FRAMEBUFFER_COMPLETE)throw document.title="FBO verification failed",console.log(this),Error();this.jd=!0;Ma(p,null)}}};d.Kj=function(f,k){this.Wi=new d.Hc((new d.qb).Rc(f,k),null);this.Ii=new d.Hc((new d.qb).Rc(f,k),null);this.w=f;this.o=k};d.Kj.prototype={resize:function(f,k){this.Wi.xd(f,k);this.Ii.xd(f,
k);this.w=f;this.o=k},xd:function(f,k){this.Wi.xd(f,k);this.Ii.xd(f,k);this.w=f;this.o=k}}});
T.Rb.push(function(a,d){function e(m,f,k,n,t,x,y,B){this.mb=m;this.L=m.L;this.Ha=f;this.nb=k;this.Sa=n;this.Fb=t;this.w=x;this.o=y;this.ze=B||1}function c(m,f,k,n){if(0<n&&!f)throw Error();this.name=m;this.Hl=f;this.ya=k;this.gh=n;this.Yg=-1;this.Gc=Float32Array;this.ie=!1;Object.preventExtensions(this)}function h(m,f){this.name=m;this.Oh=f}function q(m,f){this.name=m;var k=[],n=[];k.push("struct "+m+" {");Object.keys(f).forEach(function(t){k.push("    "+f[t]+" "+t+";");n.push(t)});k.push("};");this.dj=
k.join("\n")}function r(m){m?(this.ed=m.ed.slice(0),this.xc=m.xc.slice(0),this.bd=m.bd.slice(0),this.pc=m.pc.slice(0),this.Bc=new Set(m.Bc),this.da=new Set(m.da),this.ib=new Set(m.ib),this.kb=new Set(m.kb)):(this.ed=[],this.xc=[],this.bd=[],this.pc=[],this.Bc=new Set,this.da=new Set,this.ib=new Set,this.kb=new Set)}var g=d.G,p=d.Of;new d.la.yj;a.mo=e;e.prototype={ng:function(){this.mb.ng()},ii:!0};a.qb=function(){this.L=null;this.o=this.w=-1;this.Ib=this.Hb=this.oc=this.fb=this.$=this.xa=this.Aa=
null;this.yc=-1;this.O=!1;this.N=null;Object.preventExtensions(this)};a.qb.prototype={ng:function(){this.O&&(this.fb!==g.LINEAR&&this.fb!==g.NEAREST&&(La(p,this.L),g.generateMipmap(g.TEXTURE_2D)),this.N&&(g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),La(p,this.L),g.texSubImage2D(g.TEXTURE_2D,0,0,0,this.w,this.o,this.xa,this.$,this.N)),this.O=!1)},Ak:function(m,f){this.L&&g.deleteTexture(this.L);this.yc=this.Mg;this.w=m;this.o=f;var k=Ia(p,"WEBGL_depth_texture"),n=!1;if(0<=p.Dd.indexOf("R9 390 Series")||
0<=p.Dd.indexOf("Radeon HD 5670")||0<=p.Dd.indexOf("Radeon"))n=!0;k?(n?(this.Aa=p.V?g.DEPTH_COMPONENT16:g.DEPTH_COMPONENT,this.$=g.UNSIGNED_SHORT):p.V?(this.Aa=g.DEPTH24_STENCIL8,this.$=g.UNSIGNED_INT_24_8):(this.Aa=g.DEPTH_STENCIL,this.$=k.UNSIGNED_INT_24_8_WEBGL||34042),this.xa=this.Aa===g.DEPTH_STENCIL||this.Aa===g.DEPTH24_STENCIL8?g.DEPTH_STENCIL:g.DEPTH_COMPONENT):(this.xa=g.RGBA,this.$=g.UNSIGNED_BYTE);this.oc=this.fb=g.NEAREST;this.Ib=this.Hb=g.CLAMP_TO_EDGE;this.L=Oa(p,this);this.O=!1;return this},
Rc:function(m,f,k){this.L&&g.deleteTexture(this.L);this.yc=this.Lg;this.w=m;this.o=f;this.Aa=(this.xa=this.xa||g.RGBA)||g.RGBA;this.$=this.$||g.UNSIGNED_BYTE;1===k?this.$=Ia(p,"OES_texture_half_float").HALF_FLOAT_OES:2===k&&(this.$=g.FLOAT);this.fb=this.fb||g.LINEAR;this.oc=this.oc||g.LINEAR;this.Hb=this.Hb||g.CLAMP_TO_EDGE;this.Ib=this.Ib||g.CLAMP_TO_EDGE;this.L=Oa(p,this);this.O=!1;return this},hh:function(m,f,k,n,t){if(4>f)throw Error();this.$=k;this.xa=g.RGBA;this.fb=this.fb||g.NEAREST;this.oc=
this.oc||g.NEAREST;this.Hb=this.Hb||g.CLAMP_TO_EDGE;this.Ib=this.Ib||g.CLAMP_TO_EDGE;m=m*f/4;n&&t||(t=Math.ceil(m/128),n=T.j.Ab(m-128*(t-1)));this.Rc(n,t);this.N=new (this.$===g.FLOAT?Float32Array:Uint8Array)(n*t*4);return this},zl:function(m){if(!this.N)throw Error();var f=this.w,k=this.o;f>k||m?k=T.j.Ab(2*k):f=T.j.Ab(2*f);console.log(f,k);m=f*k;var n=this.N.length/(this.w*this.o);this.Rc(f,k);f=new (this.$===g.FLOAT?Float32Array:Uint8Array)(f*k*n);k=0;for(var t=this.N.length;k<t;k++)f[k]=this.N[k];
this.N=f;this.O=!0;return m/n},Ha:0,Sa:0,nb:1,Fb:1,ji:!0,Lg:100,Mg:101};a.Jg=function(m,f,k){this.Yh=this.Kl(m,f,k);k.forEach(function(){});this.tk=k;this.Ll(this.Yh)};a.Jg.prototype={vi:function(m,f){var k=g.createShader(f);g.shaderSource(k,m);g.compileShader(k);if(!g.getShaderParameter(k,g.COMPILE_STATUS))throw Error("creating "+(f===g.VERTEX_SHADER?"vertex":"fragment")+" shader failed: \n\n"+g.getShaderInfoLog(k)+"\n"+m);return k},Kl:function(m,f,k){m=this.vi(m,g.VERTEX_SHADER);var n=this.vi(f,
g.FRAGMENT_SHADER);f=g.createProgram();g.attachShader(f,m);g.attachShader(f,n);if(k)for(m=0,n=k.length;m<n;m++)g.bindAttribLocation(f,m,k[m]);g.linkProgram(f);if(!g.getProgramParameter(f,g.LINK_STATUS))throw Error("compiling program failed");return f},Ll:function(m){function f(w){var H=n[w];if(void 0===H)return console.log("program is not using uniform "+w),function(){};var I=H.ui;w=H.type;if(w===g.FLOAT)return function(b){g.uniform1f(I,b)};if(w===g.FLOAT_VEC2)return H.value=new ya,function(b){if(H.value[0]!==
b[0]||H.value[1]!==b[1])H.value[0]=b[0],H.value[1]=b[1],g.uniform2fv(I,b)};if(w===g.FLOAT_VEC3)return H.value=new R,function(b){H.value.gc(b)||(H.value.f(b),g.uniform3fv(I,b))};if(w===g.FLOAT_VEC4)return H.value=new wa,function(b){H.value.gc(b)||(H.value.f(b),g.uniform4fv(I,b))};if(w===g.INT)return function(b){g.uniform1i(I,b)};if(w===g.INT_VEC2)return function(b){g.uniform2iv(I,b)};if(w===g.INT_VEC3)return function(b){g.uniform3iv(I,b)};if(w===g.INT_VEC4)return function(b){g.uniform4iv(I,b)};if(w===
g.FLOAT_MAT2)return function(b){g.uniformMatrix2fv(I,!1,b)};if(w===g.FLOAT_MAT3)return function(b){g.uniformMatrix3fv(I,!1,b)};if(w===g.FLOAT_MAT4)return H.value=new P,H.value[0]=0,H.value[5]=0,H.value[10]=0,H.value[15]=0,function(b){H.value.gc(b)||(H.value.f(b),g.uniformMatrix4fv(I,!1,b))};if(w===g.SAMPLER_2D)return H.value=-1,function(b,l){void 0!==b.L&&(b.ng(),b=b.L);Ka(p,b,l,g.TEXTURE_2D);H.value!==l&&(H.value=l,g.uniform1i(I,l))};if(w===g.SAMPLER_CUBE)return H.value=-1,function(b,l){void 0===
l&&(l=0);Ka(p,b,l,g.TEXTURE_CUBE_MAP);H.value!==l&&(H.value=l,g.uniform1i(I,l))};throw Error("Not implemented or unsupported type : (glEnum)"+w);}for(var k={},n={},t=g.getProgramParameter(m,g.ACTIVE_UNIFORMS),x=0;x<t;x++){var y=g.getActiveUniform(m,x),B=y.name;y.ui=g.getUniformLocation(m,B);n[B]=y;if(B.endsWith("[0]")){B=B.slice(0,B.length-3);var z=0;for(y=y.type;;){var A=B+"["+z+"]",K=g.getUniformLocation(m,A);if(K)n[A]={ui:K,type:y},k[A]=f(A),z++;else break}}else k[B]=f(y.name)}return k},deleteShader:function(){p.deleteProgram(this.Yh)}};
r.prototype.clear=function(){this.ed=[];this.xc=[];this.bd=[];this.pc=[];this.Bc=new Set;this.da=new Set;this.ib=new Set};a.Ig=function(m){m?(this.A=new r(m.A),this.P=new r(m.P),this.vb=Object.create(m.vb),this.ub=Object.create(m.ub),this.ce=Object.create(m.ce)):(this.A=new r,this.P=new r,this.vb={},this.ub={},this.ce={});this.Cf=this.Bf=this.Kf=null;Object.preventExtensions(this)};a.Ig.prototype={b:function(m){this.A.pc.push(this.gg(m,this.A))},a:function(m){this.P.pc.push(this.gg(m,this.P))},Gh:function(m){this.P.ed.push(m)},
je:function(m){return void 0!==this.vb[m]},g:function(m,f,k,n,t,x){if(!m.startsWith("@"))throw Error();k=this.dd(k);f=new c(k,!1,f);f.Yg=void 0!==n?n:null;f.Gc=t;f.ie=x;this.vb[m]=f;return this},pa:function(m,f,k){this.g(m,f,k)},l:function(m,f,k){if(!m.startsWith("@"))throw Error();k=this.dd(k);this.vb[m]=new c(k,!0,f,0);return this},Df:function(m,f,k,n){if(!m.startsWith("@"))throw Error();if(!T.types.gi(n))throw Error();k=this.dd(k);this.vb[m]=new c(k,!0,f,n);return this},s:function(m,f,k){if(!m.startsWith("@@"))throw Error();
this.ce[m]=new h(f,k);return this},bc:function(m,f){this.ub[m]=new q(m,f);return this},ah:function(m,f){var k=this,n=f===k.A?"$V_STRUCT$":"$STRUCT$";m.split("\n").forEach(function(t){t=t.trim();t=t.split(" ")[0];k.ub[t]&&!f.kb.has(n+t)&&(f.xc.push(k.ub[t].dj),f.kb.add(n+t))})},gg:function(m,f){var k=this;this.ah(m,f);m=m.replace(this.Nj,function(t){t=k.rl(t);var x="$FUNC$"+t.name;if(!f.kb.has(x)){var y=k.gg(t.Oh,f);f.bd.push(y);f.kb.add(x)}k.ah(t.Oh,f);return t.name});if(f===this.A)for(var n=m.match(k.jf);n&&
n[1];)n=k.Wh(n[1]),this.A.ib.add(n),m=m.replace(k.jf,k.Pb+n.name+" ="),n=m.match(k.jf);m=m.replace(this.Oj,function(t){t=k.Wh(t);if(t.Hl){var x=f===k.A?"$V_STRUCT$":"$STRUCT$";k.ub[t.ya]&&!f.kb.has(x+t.ya)&&(f.xc.push(k.ub[t.ya].dj),f.kb.add(x+t.ya));f.Bc.add(t);return k.gf+t.name}if(f===k.A)return k.A.da.add(t),k.Mc+t.name;k.P.da.add(t);return k.Pb+t.name});";"!==m.slice(-1)&&"}"!==m.slice(-1)&&"{"!==m.slice(-1)&&(m+=";");return m},ae:function(m){function f(){""!==n[n.length-1]&&n.push("")}if(m===
this.A&&this.Cf)return this.Cf;if(m===this.P&&this.Bf)return this.Bf;var k=this,n=[],t=m===this.A?this.Mc:this.Pb;if(p.V)n.push("#version 300 es"),x="in ";else var x=m===this.A?"attribute ":"varying ";m.ed.forEach(function(z){n.push(z);f("")});m===this.P&&(n.push("precision mediump float;"),f(""));m===k.A&&k.P.da.forEach(function(z){k.A.ib.has(z)||m.da.add(z)});m.da.forEach(function(z){n.push(x+z.ya+" "+t+z.name+";")});f("");if(m===k.A){var y=p.V?"out ":"varying ";m.ib.forEach(function(z){n.push(y+
z.ya+" "+k.Pb+z.name+";")});k.P.da.forEach(function(z){k.A.ib.has(z)||(n.push(y+z.ya+" "+k.Pb+z.name+";"),k.A.da.add(z))})}else m===k.P&&p.V&&n.push("out vec4 out_frag_color;");f("");m.xc.forEach(function(z){n.push(z);f("")});m.Bc.forEach(function(z){var A="";m===k.P&&k.A.Bc.has(z)&&(A="highp ");0<z.gh?n.push("uniform "+A+z.ya+" "+k.gf+z.name+"["+z.gh+"];"):n.push("uniform "+A+z.ya+" "+k.gf+z.name+";")});f("");m.bd.forEach(function(z){n.push(z);f("")});n.push("void main(){");m.pc.forEach(function(z){n.push("    "+
z)});m===k.A&&k.P.da.forEach(function(z){k.A.ib.has(z)||n.push("    "+k.Pb+z.name+" = "+k.Mc+z.name+";")});n.push("}");var B=n.join("\n");p.V&&(B=B.replace(/texture2D/g,"texture"),B=B.replace(/textureCube/g,"texture"),B=B.replace(/gl_FragColor/g,"out_frag_color"));m===this.A&&(this.Cf=B);m===this.P&&(this.Bf=B);return B},ml:function(){var m=[],f=this.Mc;this.A.da.forEach(function(k){m.push(f+k.name)});return m},nl:function(m){this.ae(this.A);this.ae(this.P);var f=new d.xg,k=this.Mc;this.A.da.forEach(function(n){var t=
k+n.name,x=parseInt(n.Yg);if(!T.types.gi(x)||0>x)throw Error(n.name);switch(n.ya){case "vec4":var y=4;break;case "vec3":y=3;break;case "vec2":y=2;break;case "float":y=1;break;default:throw Error("unsupported type: "+n.type);}f.Pl(x,t,y,n.Gc,n.ie)});m&&f.Ml();return f},Vh:function(m){return this.Kf?this.Kf:this.Kf=m=new a.Jg(this.ae(this.A),this.ae(this.P),m||this.ml())},rl:function(m){var f=this.ce[m];if(!f)throw Error("undefined function call symbol: "+m);return f},Wh:function(m){var f=this.vb[m];
if(!f)throw Error("undefined symbol: "+m);return f},dd:function(m){if(m)return m;do m=T.zb.Qi(3);while(this.Sg.has(m)||T.types.Bb(m[0]));this.Sg.add(m);return m},Sg:new Set,Nj:/(@@[A-Z0-9_]*)/g,jf:/\s*(@[A-Z0-9_]*)\s*=/,Oj:/@[A-Z0-9_]*/g,Mc:"a_",Pb:"v_",gf:"u_"};a.Lc=function(m,f){f||(f=256);this.Uk=m;this.mb=(new a.qb).hh(f,m,g.FLOAT);this.se=new d.la.Kg(f);this.N=this.mb.N};a.Lc.prototype={Lf:function(){var m=this.se.Sh();0>m&&(m=this.mb.zl(),this.se.Cl(m),this.N=this.mb.N,m=this.se.Sh(),this.offset=
0);if(0>m)throw Error();return m},If:function(m){this.se.jl(m)},Ca:function(){this.mb.O=!0}}});
T.Rb.push(function(a,d){function e(b,l,u,v){this.h={rc:b,O:!0,$f:0,ag:0,Tl:0,Ie:v,wh:1,$i:0};this.c=new ba;this.m=new ba(1,1,1);this.angle=0;this.visible=!0;b.wa.Pe(b,l,u);this.Ca();this.md=u}function c(b,l){this.Jf=new Map;this.Yi=b;this.lm=l}function h(b){b.je("@TIME_RANGE")||(b.l("@TIME_RANGE","vec2","time_range"),b.g("@START_TIME","float","start_time",w.vj),b.b("float dt = mod(@TIME_RANGE.x - @START_TIME, @TIME_RANGE.y);"))}function q(b){h(b);b.je("@DT_INTERP")||(b.pa("@DT_INTERP","float","dt"),
b.b("@DT_INTERP = dt;"),b.a("float dt = @DT_INTERP;"))}function r(b,l,u,v){v||(v={});if(0!==(l.u&w.Qg)||0!==(l.u&w.Mb)){0!==(l.u&w.Qg)&&h(b);if(v=0!==(l.u&w.gk))b.g("@VEL","vec3","velocity",w.xj),b.g("@ACCEL","vec3","accel",w.rj),b.b("float startTime = @START_TIME;");b.g("@TRANSLATE","vec3","trans_startTime",w.Fc);b.b("vec3 translate = @TRANSLATE.xyz;\nvec3 pos = @POS;");u&&b.b("vec3 norm = @NORMAL;");0!==(l.u&w.ik)&&(b.g("@SCLINGS","vec4","sclings",w.uj),b.b("float sinX = sin(@SCLINGS.z * dt + @SCLINGS.w);\nfloat sinR = sinX * 0.5 + 0.5;\nfloat scl = mix(@SCLINGS.x, @SCLINGS.y, sinR);\npos *= scl;"));
(l.u&w.Mb)===w.Jd?b.b("pos = @@BILLBOARD(pos, @V_MAT);"):(l.u&w.Mb)===w.nf?(b.g("@AXIS","vec3","axis",w.Jb,Float32Array,!1),b.b("pos = @@BILLBOARD_AXIAL(pos, @AXIS, @V_MAT);")):(l.u&w.Mb)===w.Mb?(b.g("@AXIS","vec3","axis",w.Jb,Float32Array,!1),b.b("pos = @@BILLBOARD_TEST(pos.xy, @AXIS, @V_MAT, translate + @VEL * dt + @ACCEL * dt * dt);")):0!==(l.u&w.hk)&&(b.s("@@AXIS_ANGLE_TO_QUAT","axisAngle_to_quat","vec4 axisAngle_to_quat(vec3 axis, float angle){\n   angle = angle/2.0;\n   vec4 quat;\n   float sinT = sin(angle);\n   quat.xyz = axis.xyz * sinT;\n   quat.w = cos(angle);\n   return quat;\n}"),
b.s("@@APPLY_QUAT","apply_quat","vec3 apply_quat(inout vec3 v, vec4 q){\n   vec3 t = 2.0 * cross(q.xyz, v);\n   v += q.w * t + cross(q.xyz, t);\n   return v;\n}"),b.g("@AXISROT","vec4","axis_rot",w.sj),b.b("   float angle = @AXISROT.w * dt;\n   vec4 q = @@AXIS_ANGLE_TO_QUAT(@AXISROT.xyz, angle);\n   pos = @@APPLY_QUAT(pos, q);"));v&&b.b("pos += @VEL * dt + 0.5 * @ACCEL * dt * dt;");b.b("pos += translate;");b.b("vec4 posVS = @V_MAT * vec4(pos, 1.0);");u&&b.b("vec3 normVS = (@V_MAT * vec4(norm, 0.0)).xyz;")}else l.u===
w.jk?(b.b("vec4 posVS = @V_MAT * vec4(@POS, 1.0);"),u&&b.b("vec3 normVS = (@V_MAT * vec4(@NORMAL, 0.0)).xyz;")):l.u===w.pf?(b.g("@BONE","vec4","boneMatrix",w.Te),b.g("@WEIGHT","vec4","boneWeight",w.Ue),b.l("@TRANSFORMS","sampler2D","transforms"),b.l("@TEX_WH_INV","vec2","transformsWH_inv"),b.b("mat4 boneTransform = @WEIGHT.x * @@READ_MATRIX_OPTZ(@BONE.x, @TRANSFORMS, @TEX_WH_INV);"),b.b("boneTransform += @WEIGHT.y * @@READ_MATRIX_OPTZ(@BONE.y, @TRANSFORMS, @TEX_WH_INV);"),b.b("boneTransform += @WEIGHT.z * @@READ_MATRIX_OPTZ(@BONE.z, @TRANSFORMS, @TEX_WH_INV);"),
b.b("boneTransform += @WEIGHT.w * @@READ_MATRIX_OPTZ(@BONE.w, @TRANSFORMS, @TEX_WH_INV);"),b.b("mat4 modelView = @V_MAT * boneTransform;"),b.b("vec4 posVS = modelView * vec4(@POS,1.0);"),u&&(B.V?b.b("vec3 normVS = (inverse(transpose(modelView)) * vec4(@NORMAL, 0.0)).xyz;"):b.b("vec3 normVS = (modelView * vec4(@NORMAL, 0.0)).xyz;"))):l.u===w.Kd?(b.g("@BONE","vec4","boneMatrix",w.Te),b.g("@WEIGHT","vec4","boneWeight",w.Ue),b.l("@DQS","sampler2D","dualQuats"),b.l("@DQ_WH_INV","vec2","dualQuatsINVWH"),
b.b("vec4 qR; vec4 qD;"),b.b("vec4 dR0, dR1, dR2, dR3, dQ0, dQ1, dQ2, dQ3;"),b.b("@@READ_2VEC4_OPTZ(@BONE.x, @DQS, @DQ_WH_INV, dR0, dQ0);\n@@READ_2VEC4_OPTZ(@BONE.y, @DQS, @DQ_WH_INV, dR1, dQ1);\n@@READ_2VEC4_OPTZ(@BONE.z, @DQS, @DQ_WH_INV, dR2, dQ2);\n@@READ_2VEC4_OPTZ(@BONE.w, @DQS, @DQ_WH_INV, dR3, dQ3);\n\n\n   float v1 = step(0.0, dot(dR0, dR1)) * 2.0 - 1.0;\n   dR1 *= v1; dQ1 *= v1;\n   float v2 = step(0.0, dot(dR0, dR2)) * 2.0 - 1.0;\n   dR2 *= v2; dQ2 *= v2;\n   float v3 = step(0.0, dot(dR0, dR3)) * 2.0 - 1.0;\n   dR3 *= v3; dQ3 *= v3;\n\n   qR = @WEIGHT.x * dR0; qD = @WEIGHT.x * dQ0;\n   qR += @WEIGHT.y * dR1; qD += @WEIGHT.y * dQ1;\n   qR += @WEIGHT.z * dR2; qD += @WEIGHT.z * dQ2;\n   qR += @WEIGHT.w * dR3; qD += @WEIGHT.w * dQ3;\n\nfloat invLen = 1.0/length(qR);\nqR*=invLen;\nqD*=invLen;"),
v.cl?b.b("vec3 pos = @POS.xyz + @NORMAL.xyz * 0.005;"):b.b("vec3 pos = @POS.xyz;"),b.b("vec4 posVS = @V_MAT * vec4(@@POS_DQ(pos, qR, qD),1.0);"),u&&b.b("vec3 normVS = (@V_MAT * vec4(@@NORM_DQ(@NORMAL.xyz, qR, qD),0.0)).xyz;")):(l.u===w.kk?(b.l("@MV_MAT","mat4","modelView"),b.b("mat4 modelView = @MV_MAT;")):(b.g("@M_INDEX","float","mIndex",w.vg,Uint16Array,!1),b.l("@TRANSFORMS","sampler2D","transforms"),b.l("@TEX_WH_INV","vec2","transformsWH_inv"),b.b("mat4 modelView = @V_MAT * @@READ_MATRIX_OPTZ(@M_INDEX, @TRANSFORMS, @TEX_WH_INV);")),
b.b("vec3 pos = @POS.xyz;"),(l.u&w.Mb)===w.Jd&&b.b("pos = @@BILLBOARD(vec3(pos.xy, @POS.z), @V_MAT);"),b.b("vec4 posVS = modelView * vec4(pos,1.0);"),u&&b.b("vec3 normVS = (modelView * vec4(@NORMAL, 0.0)).xyz;"))}function g(b,l){0<=l.h.rd?f(b,l,l.i[l.h.rd],l.h.rd,!0):(b.b("@FRAG_POS = posVS.xyz;"),b.b("@NORMAL_INTERP = normVS;"),b.a("vec3 N = normalize(@NORMAL_INTERP);"))}function p(b,l,u,v,C,D){b.a("{");b.a("vec3 diff = "+v+".light_pos.xyz - @FRAG_POS * ("+v+".light_pos.w);");b.a("float dist = length(diff);");
b.a("vec3 L = normalize(diff);");b.a("float attenuation = 1.0 / ("+v+".const_linear_quadratic.x + "+v+".const_linear_quadratic.y * dist + "+v+".const_linear_quadratic.z * (dist * dist));");b.a("float theta = dot(L, -"+v+".light_dir.xyz);");b.a("float epsilon = "+v+".light_color.w - "+v+".light_dir.w;");b.a("float intensity = clamp((theta - "+v+".light_dir.w)/epsilon, 0.0, 1.0);");b.a("vec3 lightColor = "+v+".light_color.rgb * intensity;");l.J===w.Qj?b.a("   vec3 H = normalize(L + V);\n   \n   float VdotH = abs(dot(V,H));\n   float NdotH = abs(dot(N,H));\n   float NdotL = abs(dot(N,L));\n   float wrap = 0.3;\n   NdotL = (NdotL + wrap)/(1.0+wrap);\n"):
b.a("   vec3 H = normalize(L + V);\n   \n   float VdotH = max(dot(V,H), 0.0);\n   float NdotH = max(dot(N,H), 0.0);\n   float NdotL = max(dot(N,L), 0.0);\n");l.J===w.mf&&b.a("   float _wrap = 0.2;\n   NdotL = max(0.0, (dot(N,L) + _wrap)/(1.0+_wrap));");b.a("   vec3 diffuse = diffuseColor * NdotL;");l.J&&l.J!==w.mf&&l.J!==w.Hg?l.J===w.lf&&(b.a("float wrap = 0.3;"),b.a("float NdotLWrap = max(0.0, (dot(N,L) + wrap)/(1.0+wrap));"),b.a("diffuse = NdotLWrap * diffuseColor * 0.7;"),b.a("vec3 spec = vec3(0.0);"),
b.a("vec3 T = normalize(@TBN[1]);"),b.a("T = normalize(T + (0.1) * N);"),b.a("float TdotH = dot(T,H);"),b.a("float sinTH = sqrt(1.0 - TdotH * TdotH);\nfloat dirAtten = smoothstep(-1.0, 0.0, TdotH);\nfloat specPower = 30.0;\nfloat specNormalization = (specPower + 8.0)/(3.14159*8.0);\nfloat s = dirAtten * pow(sinTH, specPower) * specNormalization;\nspec += s * diffuseColor*0.3 * NdotL;"),b.a("{\nvec3 T = normalize(@TBN[1]);\nT = normalize(T + (-0.3) * N);\nfloat TdotH = dot(T,H);\nfloat sinTH = sqrt(1.0 - TdotH * TdotH);\nfloat dirAtten = smoothstep(-1.0, 0.0, TdotH);\nfloat specPower = 150.0;\nfloat specNormalization = (specPower + 8.0)/(3.14159*8.0);\nfloat s = dirAtten * pow(sinTH, specPower) * specNormalization;\nspec += vec3(0.05) * s * NdotL;\n}")):
(b.s("@@F","F_Schlick","vec3 F_Schlick(float angle, vec3 F0){\n   return F0 + (vec3(1.0) - F0) * pow(1.0 - angle, 5.0);\n}"),b.s("@@D","D_GGX","float PI = 3.141592;\n\nfloat D_GGX(float NdotH, float alpha){\n   float aSqr = alpha*alpha;\n   float denom = NdotH * NdotH * (aSqr - 1.0) + 1.0;\n   return aSqr/(PI * denom * denom);\n}"),b.s("@@VIS","G_SchlickSmith","\nfloat G1(float NdotV, float k){\n   return 1.0/(NdotV*(1.0-k)+k);\n}\nfloat G_SchlickSmith(float NdotL, float NdotV, float alpha){\n   float k = alpha * 0.5;\n   return G1(NdotL, k) * G1(NdotV, k);\n}"),
b.a("   vec3 spec = @@D(NdotH, alpha) * @@VIS(NdotL, NdotV, alpha) * @@F(VdotH, specColor) * NdotL;"));l.Nc&&(b.a("   if (NdotL > 0.8){\n       NdotL = 0.8;\n   }"),b.a(["{\nfloat wrap = 0.3;\nfloat scatterWidth = 0.3;",l.J!==w.Hg?"vec3 scatterColor = vec3(0.12, 0.0, 0.0) * diffuseColor;":"vec3 scatterColor = vec3(0.02, 0.05, 0.02);","float NdotLWrap = max( (dot(N,L) + wrap) / (1.0+wrap), 0.0);\nfloat scatter = smoothstep(0.0, scatterWidth, NdotLWrap) * smoothstep(scatterWidth * 2.0, scatterWidth, NdotLWrap);\ndiffuse += scatter * scatterColor;\n}"].join("\n")),
b.a("{\nfloat fLTDistortion = 0.5;\nfloat iLTPower = 4.0;\nfloat fLTScale = 0.3;\nfloat fLTAmbient = 0.05;\nfloat fLTThickness = 1.0;\nvec3 vLTLight = L + N * fLTDistortion;\nfloat fLTDot = pow(max(0.0,dot(V, -vLTLight)), iLTPower) * fLTScale;\nfloat fLT = (fLTDot + fLTAmbient) * fLTThickness;\ndiffuse += mix(vec3(1.0,0.0,0.0),diffuseColor,0.8) * lightColor * fLT;\n}"));u&&l.Ti&&(D?b.a("float bias = max(0.002 * (1.0 - NdotL), 0.0015);"):(b.a("float bias = max(0.0025 * (1.0 - NdotL), 0.0025);"),(l.Nc||
l.J===w.mf)&&b.a("bias *= 2.0;")),b.a("vec2 shadow_texelSize = "+v+".shadow_texel;"),b.s("@@INSIDE_BOX","insideBox","float insideBox(vec2 v, vec2 bottomLeft, vec2 topRight){\n    vec2 s = step(bottomLeft, v) - step(topRight, v);\n    return s.x * s.y;\n}"),D&&b.s("@@GET_UV_CASCADED","get_uv_cascaded","vec2 get_uv_cascaded(vec3 projCoords, float cascadeIndex){\n   vec2 uv = projCoords.xy * 0.5;\n   uv.x += mod(cascadeIndex, 2.0) * 0.5;\n   uv.y += floor(cascadeIndex / 2.0) * 0.5;\n   return uv;\n}"),
b.s("@@SHADOW_CALC_PCF_INTERP","shadowCalcPCF_Interp",["float shadowCmp(sampler2D shadowMap, vec2 uv, float compare){",Ia(B,"WEBGL_depth_texture")?"float closestDepth = texture2D(shadowMap, uv).r;":"float closestDepth = @@UNPACK_FLOAT(texture2D(shadowMap, uv));","    return step(closestDepth, compare);\n}\n\nfloat shadowLerp(sampler2D shadowMap, vec2 uv, float compare, vec2 texelSize, vec2 invSize){\n   vec2 f = fract(uv*invSize + 0.5);\n   vec2 c = floor(uv*invSize + 0.5)*texelSize;\n   float lb = shadowCmp(shadowMap, c + texelSize*vec2(0.0, 0.0), compare);\n   float lt = shadowCmp(shadowMap, c + texelSize*vec2(0.0, 1.0), compare);\n   float rb = shadowCmp(shadowMap, c + texelSize*vec2(1.0, 0.0), compare);\n   float rt = shadowCmp(shadowMap, c + texelSize*vec2(1.0, 1.0), compare);\n   float a = mix(lb, lt, f.y);\n   float b = mix(rb, rt, f.y);\n   return mix(a, b, f.x);\n}\nfloat shadowCalcPCF_Interp(float curDepth, vec2 uv, sampler2D shadowMap, float bias, vec2 texelSize){\n   float shadow = 0.0;\n   \n   vec2 invSize = 1.0/texelSize;\n   for (int x = -1; x<=1;x++){\n       for (int y = -1; y<=1;y++){\n           shadow += shadowLerp(shadowMap, uv + vec2(x,y)*texelSize, curDepth - bias, texelSize, invSize);\n       }\n   }\n   return shadow/9.0;\n}"].join("\n")),
b.a("   vec3 projCoords = fragLight.xyz/fragLight.w;\n   projCoords = projCoords * 0.5 + 0.5;\n   float curDepth = projCoords.z;"),D?b.a(["vec2 uv = @@GET_UV_CASCADED(projCoords, float("+D+"));","float shadow = @@SHADOW_CALC_PCF_INTERP(curDepth, uv, "+C+", bias, shadow_texelSize);"].join("\n")):b.a(["vec2 uv = projCoords.xy;\nfloat t = @@INSIDE_BOX(uv, vec2(0.0, 0.0), vec2(1.0, 1.0)) * step(curDepth, 0.95);","float shadow = @@SHADOW_CALC_PCF_INTERP(curDepth, uv, "+C+", bias, shadow_texelSize);","shadow *= t;"].join("\n")),
b.a("shadow = 1.0 - shadow;"),b.a("diffuse *= (shadow);"),b.a("spec *= (shadow);"));b.a("directSpec += spec * lightColor * attenuation;\ndirectDiffuse += diffuse * lightColor * attenuation;");b.a("}")}function m(b,l){if(l.vd||l.hd||l.fc){b.l("@IV_MAT","mat4","invView");if(l.vd||l.fc)b.s("@@B","envBRDF","vec3 envBRDF(vec3 specColor, float roughness, float NdotV){\n   vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\n   vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);\n   vec4 r = roughness * c0 + c1;\n   float a004 = min(r.x * r.x, exp2(-9.28 * NdotV))*r.x +r.y;\n   vec2 AB = vec2(-1.04, 1.04)*a004 + r.zw;\n   return specColor * AB.x + AB.y;\n}"),
b.l("@SKYBOX","samplerCube","cube_map"),b.l("@REFLECT_WEIGHT","float","reflectionWeight"),b.l("@MAX_LODLEVEL","float","maxLodLevel"),Ia(B,"EXT_shader_texture_lod")?(B.V||b.Gh("#extension GL_EXT_shader_texture_lod : enable"),b.a("vec3 R = reflect(-V, N);"),b.a("R = (@IV_MAT * vec4(R, 0.0)).xyz;"),b.a("float rough = 1.0 - (material.smoothness * material.smoothness)*0.98;"),B.V?b.a("vec3 specReflect = (textureLod(@SKYBOX, R, rough * @MAX_LODLEVEL)).rgb;"):b.a("vec3 specReflect = (textureCubeLodEXT(@SKYBOX, R, roughness * @MAX_LODLEVEL)).rgb;"),
b.a("indirectSpec = @@B(specColor, rough, NdotV) * specReflect * @REFLECT_WEIGHT;")):(b.a("vec3 R = reflect(-V, N);"),b.a("R = (@IV_MAT * vec4(R, 0.0)).xyz;"),b.a("indirectSpec = 0.2 * textureCube(@SKYBOX, R).rgb * @@B(specColor, roughness, NdotV) * @REFLECT_WEIGHT;"));if(l.hd||l.fc)b.bc("SH9",{"c[9]":"float"}),b.bc("SH9Color",{"c[9]":"vec3"}),b.l("@SH_COLORS","SH9Color","SH9Colors"),b.s("@@SH_DIFFUSE","computeSHDiffuse","const float CosineA0 = 1.0;\nconst float CosineA1 = 2.0/3.0;\nconst float CosineA2 = 0.25;\n\nvoid SHCosineLobe(inout SH9 sh, vec3 dir){\n   \n   sh.c[0] = 0.282095 * CosineA0;\n\n   sh.c[1] = 0.488603 * dir.y * CosineA1;\n   sh.c[2] = 0.488603 * dir.z * CosineA1;\n   sh.c[3] = 0.488603 * dir.x * CosineA1;\n\n   sh.c[4] = 1.092548 * dir.x * dir.y * CosineA2;\n   sh.c[5] = 1.092548 * dir.y * dir.z * CosineA2;\n   sh.c[6] = 0.315392 * (3.0 * dir.z * dir.z - 1.0) * CosineA2;\n   sh.c[7] = 1.092548 * dir.x * dir.z * CosineA2;\n   sh.c[8] = 0.546274 * (dir.x * dir.x - dir.y * dir.y) * CosineA2;\n   \n}\n\nvec3 computeSHIrradiance(vec3 normal, SH9Color radiance){\n   SH9 shCosine;\n   SHCosineLobe(shCosine, normal);\n   vec3 irradiance = vec3(0.0);\n   for (int i = 0; i<9; ++i){\n       irradiance += radiance.c[i] * shCosine.c[i];\n   }\n   return irradiance;\n}\n\nvec3 computeSHDiffuse(vec3 normal, SH9Color radiance, vec3 diffuseColor){\n   return computeSHIrradiance(normal, radiance) * diffuseColor;\n}"),
b.a("vec3 worldN = normalize((@IV_MAT * vec4(N, 0.0)).xyz);"),b.a("indirectDiffuse = @@SH_DIFFUSE(worldN, @SH_COLORS, diffuseColor);")}}function f(b,l,u,v,C){var D=u.usage;if(0!==D){var F=D&w.Ld;D&=w.Hd;var J=u.jj;if(0!==D&&(C||D!==w.Id)){var M="@UV"+J;u="uv"+v;b.je(M)||b.g(M,"vec2","uv"+J,w.Va+J);if(0==F)b.a("vec2 "+u+" = "+M+";");else{h(b);J="@UV_DELTA"+v;b.g(J,"vec4","uv_ramp"+v,w.Ec+v);var O="@UV_V"+v;if(F===w.Ed)b.pa(O,"vec2","uv_varying"+v),b.b((O+" = "+M+" + vec2(floor(mod(!DELTA!.x * dt + !DELTA!.y, !DELTA!.z)/!DELTA!.w) * !DELTA!.w,0);").replace(/!DELTA!/g,
J)),b.a("vec2 "+u+" = "+O);else if(F===w.Ic)F="@UV_BOUNDS"+v,b.g(F,"vec4","uv_bounds"+v,w.Kb+v),q(b),b.a(("vec2 "+u+" = mod(!DELTA!.xy * dt + "+M+" -!BOUND!.xy, !BOUND!.zw) + !BOUND!.xy;").replace(/!BOUND!/g,F).replace(/!DELTA!/g,J));else if(F===w.bf)F="@UV_BOUNDS"+v,b.pa(O,"vec2","uv_varying"+v),b.g(F,"vec4","uv_bounds"+v,w.Kb+v),b.b((O+" = clamp("+M+" + !DELTA!.xy * dt, !BOUND!.xy, !BOUND!.zw);").replace(/!BOUND!/g,F).replace(/!DELTA!/g,J)),b.a("vec2 "+u+" = "+O);else throw Error();}F="@TEXTURE"+
v;b.l(F,"sampler2D","texture"+v);if(C)if(D===w.Id)b.g("@T","vec3","tangent",w.Ve),b.pa("@TBN","mat3","TBN"),l.u===w.Kd?b.b("vec3 T = (@V_MAT * vec4(@@NORM_DQ(@T.xyz, qR, qD),0.0)).xyz;"):b.b("vec3 T = normalize(vec3(modelView * vec4(@T, 0.0)));"),b.b("vec3 N = normalize(normVS);"),b.b("T = normalize(T - dot(T, N)*N);"),b.b("vec3 B = cross(T,N);"),b.b("mat3 TBN = mat3(T, B, N)"),b.b("@FRAG_POS = posVS.xyz;"),b.b("@TBN = TBN;"),b.a("vec3 N = texture2D("+F+", "+u+").rgb;"),b.a("N = N * 2.0 - 1.0;"),
b.a("N = normalize(@TBN * N);");else throw Error();else if(0!==D){b.a("{");b.a("vec4 rgba = texture2D("+F+","+u+");");switch(D){case w.Og:b.a("material.baseColor *= rgba;");break;case w.Yj:break;case w.Ng:b.a("material.baseColor += rgba;");break;case w.Zj:b.a("material.baseColor.rgb += rgba.rgb;");break;case w.fk:b.a("material.smoothness = rgba.r;");b.a("material.metalness = rgba.g;");break;case w.Xj:b.a("material.baseColor.rgb = mix(material.baseColor.rgb, rgba.rgb, rgba.a);");break;case w.$j:b.a("material.baseColor.rgb = rgba.rgb;");
b.a("material.baseColor.a = 1.0;");b.a("material.smoothness = rgba.a;");break;case w.ek:b.a("material.smoothness = rgba.r;");break;case w.ak:b.a("if (rgba.r < 0.9){discard;};");break;case w.bk:b.a("if (rgba.r < 0.75){discard;};");break;case w.ck:b.a("if (rgba.r < 0.5){discard;};");break;case w.dk:b.a("if (rgba.r < 0.25){discard;};");break;case w.Wj:b.a("material.baseColor *= rgba.r;");break;default:throw Error();}b.a("}")}}}}function k(b,l,u,v,C){this.h={rc:b};u.u===w.Rg?(A||(A=new a.Lc(16,64)),0<=
v?this.Qa=v:(this.Qa=A.Lf(),this.c=ia(d.sc.yh(ba),0,0,0),this.F=d.sc.yh(ka).wb(),this.m=ia(d.sc.yh(ba),1,1,1),this.Ca()),b.wa.Pe(b,l,u,this.Qa,null,C)):b.wa.Pe(b,l,u,-1,null,C);this.ma=-1;this.visible=!0;this.md=u}function n(b,l,u,v,C){this.h={rc:b};this.md=u;b.wa.Pe(b,l,u,-1,v,null,C)}function t(b,l){this.h={gb:[],Ea:b};l||(A||(A=new a.Lc(16,64)),this.zc=A.Lf(),this.c=new ba,this.F=new ka,this.m=new ba(1,1,1));this.gb=this.h.gb;this.visible=!0;this.ma=-1}function x(b,l,u,v,C,D,F){this.sd=b;this.Ba=
new R(l);this.ra=new xa(u);this.ea=void 0!==v?new R(v):null;null!==b?(this.K=new R(this.Ba),this.T=new xa(this.ra),this.fa=this.ea?new R(this.ea):null):(this.K=this.Ba,this.T=this.ra,this.fa=this.ea?this.ea:null);this.c=this.K;this.F=this.T;this.m=this.fa;this.wf=D||-1;this.Yb=C;this.Tc=F;this.me=new xa;this.le=new R;this.nc=new P;this.rf=new P;this.oj=new P;this.Ka=null;this.ve=new R;this.xe=new xa;this.ue=new R;this.we=new xa;this.La=null;Object.preventExtensions(this)}function y(b,l,u,v,C,D){var F=
this;this.Ea=b;this.Na=u||!1;D?this.Fa=D:this.Na?(K||(K=new a.Lc(8,128)),this.Fa=K):(A||(A=new a.Lc(16,128)),this.Fa=A);b=l.Wa;Pa.call(this,b.fh,b.Ko);u=b.U;D=this.U=[];if(v)J=v.U[0].sd,this.c=v.c,this.F=v.F,this.m=v.m,this.H=[],this.Fa=v.Fa;else{var J=new x(null,new R(0,0,0),new xa,new R(1,1,1),-1,-1,-1);this.c=J.K;this.F=J.T;this.m=J.fa;this.H=[]}for(var M=0,O=u.length;M<O;M++){var N=u[M];v&&C&&C.has(v.U[M])?(D[M]=v.he(N.La),v.H[M]=null,this.H[M]=D[M]):v&&v.he(N.La)?(D[M]=v.he(N.La),this.H[M]=null):
(D[M]=new x(D[N.Lp]||J,N.c,N.F,N.m,this.Fa.Lf(),N.wf,M),this.H[M]=D[M]);D[M].La=N.La}C=this.H;this.H=[];C.forEach(function(Q){Q&&F.H.push(Q)});v&&(C=v.H,v.H=[],C.forEach(function(Q){Q&&v.H.push(Q)}));this.Nl=l;this.Wa=b;this.$b=null;this.yf();Object.preventExtensions(this)}var B=d.Of;new P;var z=a.af={},A=null,K=null,w=d.pb,H=a.Ig;if(!H)throw Error();a.Gj=function(b){this.ri=this.Vf=this.c=null;new R(1,.01,1E-4);this.rh=this.sh=this.kd=this.lg=null;this.kg=-1;T.la.Xi(this,b);this.lg&&!this.kd&&(this.kd=
new T.Kc(new P,oa(-10,10,-10,10,0,128)));if(2<=this.kg)for(this.rh=[],this.sh=[],b=0;b<this.kg;b++)this.rh[b]=-1,this.sh[b]=new P;this.kd&&!this.c&&(this.c=new wa,b=this.kd.Wg,this.c[0]=b[12],this.c[1]=b[13],this.c[2]=b[14],this.c[3]=1);null===this.c?this.c=new wa(0,0,0,1):this.c[3]||(b=new wa(4),b[0]=this.c[0],b[1]=this.c[1],b[2]=this.c[2],b[3]=void 0!==this.c[3]?this.c[3]:1,this.c=b);this.Vf=null===this.Vf?new R(1,1,1):new R(this.Vf);null===this.ri&&(this.ri=new R(0,0,1));if(this.lg&&!this.kd)throw Error();
new xa;this.lg?2<=this.kg?d.Db.th=this:d.Db.Zi.push(this):d.Db.si.push(this);d.Db.yk.push(this);this.cb=!0};a.Gj.prototype={enable:function(b){this.cb=b}};c.prototype={Uh:function(b){var l=b.Zc||d.af.pd.sl(b);if(!this.Jf.has(l)){var u=this.lm(b);this.Jf.set(l,u);if(u){var v=b.Ph().ol();if(u&&this!==d.af.pd){var C=d.af.pd.Uh(b).Vh(v);C=C?C.tk:null}if(C){b=0;for(var D=v.length;b<D;b++)if(v[b]!==C[b])throw console.log(v,C),Error();}u.Vh(v)}}return u=this.Jf.get(l)},sl:function(b){return this.Yi(b)}};
var I=new H;I.l("@M_MAT","mat4","model");I.l("@V_MAT","mat4","view");I.l("@P_MAT","mat4","projection");I.l("@NEARFAR","vec2","nearfar");I.l("@MV_MAT","mat4","modelView");I.l("@VP_MAT","mat4","viewProjection");I.l("@MVP_MAT","mat4","modelViewProjection");I.l("@CAM_POS","vec3","camWorldPos");I.l("@INV_RES","vec2","invResolution");I.s("@@READ_MATRIX","read_matrix","mat4 read_matrix(float modelIndex, sampler2D dataTexture, vec2 textureWidthHeight){\n   float dataPerIndex = 4.0;\n   float textureWidth = textureWidthHeight.x;\n   float textureHeight = textureWidthHeight.y;\n   float dataPerRow = textureWidth / dataPerIndex;\n   \n   float row = floor(modelIndex / dataPerRow);\n   float col = (modelIndex - row * dataPerRow) * dataPerIndex;\n   \n   vec2 uv = vec2((col+0.5)/textureWidth, (row+0.5)/textureHeight);\n   vec2 shift = vec2(1.0/textureWidth, 0.0);\n   \n   vec4 first = texture2D(dataTexture, uv);\n   vec4 second = texture2D(dataTexture, uv + shift);\n   vec4 third = texture2D(dataTexture, uv + shift*2.0);\n   vec4 fourth = texture2D(dataTexture, uv + shift*3.0);\n   return mat4(first, second, third, fourth);\n}");
I.s("@@READ_MATRIX_OPTZ","read_matrix_optz","mat4 read_matrix_optz(float modelIndex, sampler2D dataTexture, vec2 invTextureWH){\n   float dataPerIndex = 4.0;\n   \n   float row = floor(modelIndex * dataPerIndex * invTextureWH.x);\n   \n   vec2 uv = vec2(\n                   (modelIndex * dataPerIndex + 0.5) * invTextureWH.x - row,\n                   (row+0.5)*invTextureWH.y\n             );\n   vec2 shift = vec2(invTextureWH.x, 0.0);\n   \n   vec4 first = texture2D(dataTexture, uv);\n   vec4 second = texture2D(dataTexture, uv + shift);\n   vec4 third = texture2D(dataTexture, uv + shift*2.0);\n   vec4 fourth = texture2D(dataTexture, uv + shift*3.0);\n   return mat4(first, second, third, fourth);\n}");
I.s("@@READ_2VEC4","read_two_vec4","void read_two_vec4(float modelIndex, sampler2D dataTexture, vec2 textureWidthHeight, out vec4 a, out vec4 b){\n   float dataPerIndex = 2.0;\n   float textureWidth = textureWidthHeight.x;\n   float textureHeight = textureWidthHeight.y;\n   float dataPerRow = textureWidth / dataPerIndex;\n   float row = floor(modelIndex / dataPerRow);\n   float col = (modelIndex - row * dataPerRow) * dataPerIndex;\n   \n   vec2 uv = vec2((col+0.5)/textureWidth, (row+0.5)/textureHeight);\n   vec2 shift = vec2(1.0/textureWidth, 0.0);\n\n   a = texture2D(dataTexture, uv);\n   b = texture2D(dataTexture, uv + shift);\n}");
I.s("@@READ_2VEC4_OPTZ","read_two_vec4_optz","void read_two_vec4_optz(float modelIndex, sampler2D dataTexture, vec2 invTextureWH, out vec4 a, out vec4 b){\n   float dataPerIndex = 2.0;\n   float row = floor(modelIndex * dataPerIndex * invTextureWH.x);\n   \n   vec2 uv = vec2(\n                   (modelIndex * dataPerIndex + 0.5) * invTextureWH.x - row,\n                   (row+0.5)*invTextureWH.y\n             );\n   vec2 shift = vec2(invTextureWH.x, 0.0);\n\n   a = texture2D(dataTexture, uv);\n   b = texture2D(dataTexture, uv + shift);\n}");
I.s("@@POS_DQ","transform_positionDQ","vec3 transform_positionDQ(vec3 pos, vec4 realDQ, vec4 dualDQ){\n   return pos +\n       2.0 * cross(realDQ.xyz, cross(realDQ.xyz, pos) + realDQ.w * pos) + \n       2.0 * (realDQ.w * dualDQ.xyz - dualDQ.w * realDQ.xyz + \n               cross(realDQ.xyz, dualDQ.xyz));\n}");I.s("@@NORM_DQ","transform_normalDQ","vec3 transform_normalDQ(vec3 normal, vec4 realDQ, vec4 dualDQ){\n   return normal + 2.0 * cross(realDQ.xyz, cross(realDQ.xyz, normal) + \n       realDQ.w * normal);\n}");
I.s("@@PACK_FLOAT","packFloatToRGBA","vec4 packFloatToRGBA(float v){\n   const vec3 bitEnc = vec3(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0);\n   vec4 r = vec4(fract(v * bitEnc), v);\n   r.yzw -= r.xyz * 1.0/256.0;\n   return r * 256.0/255.0;\n}");I.s("@@UNPACK_FLOAT","unpackRGBAtoFloat","float unpackRGBAtoFloat(vec4 v4){\n   const vec4 bitDeEnc = (255.0/256.0)/(vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0));\n   return dot(v4, bitDeEnc);\n}");I.s("@@PACK_2_HALF","pack_2_half","vec4 pack_2_half(vec2 val){\n   const vec2 bit_shift = vec2(256.0, 1.0);\n   const vec2 bit_mask = vec2(0.0, 1.0/256.0);\n   vec2 res1 = fract(val.x * bit_shift);\n   res1 -= res1.xx * bit_mask;\n   vec2 res2 = fract(val.y * bit_shift);\n   res2 -= res2.xx * bit_mask;\n   return vec4(res1.x, res1.y, res2.x, res2.y);\n}");
I.s("@@UNPACK_2_HALF","unpack_2_half","vec2 unpack_2_half(vec4 val){   const vec2 unshift = vec2(1.0/256.0, 1.0);\n   return vec2(dot(val.xy, unshift), dot(val.zw, unshift));\n}");I.s("@@PACK_NORMALS","pack_normals","vec4 pack_normals(vec3 normal){\n   float f = sqrt(8.0 * normal.z + 8.0);\n   vec2 enc = normal.xy / f + 0.5;\n   return @@PACK_2_HALF(enc);\n}");I.s("@@UNPACK_NORMALS","unpack_normals","vec3 unpack_normals(vec4 p){\n   vec2 enc = @@UNPACK_2_HALF(p);\n   enc = enc*4.0-2.0;\n   float f = dot(enc, enc);\n   float g = sqrt(1.0-f/4.0);\n   vec3 n;\n   n.xy = enc * g;\n   n.z = 1.0-f/2.0;\n   return n;\n}");
I.s("@@BILLBOARD","billboard","vec3 billboard(vec3 v, mat4 view){\n   vec3 up = vec3(view[0][1], view[1][1], view[2][1]);\n   vec3 right = vec3(view[0][0], view[1][0], view[2][0]);\n   vec3 dir = vec3(view[0][2], view[1][2], view[2][2]);\n   vec3 p = right * v.x + up * v.y + dir * v.z;\n   return p;\n}");I.s("@@BILLBOARD_AXIAL","billboard_axial","vec3 billboard_axial(vec3 v, vec3 axis, mat4 view){\n   vec3 dir = vec3(view[0][2], view[1][2], view[2][2]);\n   vec3 p = axis * v.y + -normalize(cross(dir, axis)) * v.x + dir * v.z;\n   return p;\n}");
I.s("@@BILLBOARD_TEST","billboard_axial","vec3 billboard_axial(vec2 v, vec3 axis, mat4 view, vec3 pos){\n   vec3 dir = pos - @CAM_POS;\n   vec3 p = axis * v.y + normalize(cross(dir, axis)) * v.x;\n   return p;\n}");I.s("@@NOISE2","snoise","vec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 permute(vec3 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nfloat snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n\n  vec2 i1;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n\t\t+ i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}");
I.bc("Light",{light_pos:"vec4",light_color:"vec4",light_dir:"vec4",const_linear_quadratic:"vec4"});I.bc("Material",{baseColor:"vec4",smoothness:"float",metalness:"float"});z.Zo=new c(function(b){return(b.Uc?"s":"0")+(b.hb?"t":"0")+(b.ga?(100*b.ga).toFixed(0):"0")+(b.J.toFixed(0)+",")+(b.u.toFixed(0)+",")+(b.hb||0<b.ga)?(b.i[0]?b.i[0].usage.toFixed(0):"0")+","+((b.i[1]?b.i[1].usage.toFixed(0):"0")+",")+((b.i[2]?b.i[2].usage.toFixed(0):"0")+",")+((b.i[3]?b.i[3].usage.toFixed(0):"0")+","):""},function(b){if(!1===
b.Uc||b.J===w.Gd)return null;var l=new H(I);l.g("@POS","vec3","position",w.ba);r(l,b,!1);Ia(B,"WEBGL_depth_texture")?(l.b("gl_Position = @P_MAT * posVS;"),l.a("gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);")):(l.b("gl_Position = @P_MAT * posVS;"),l.a("gl_FragColor = @@PACK_FLOAT(gl_FragCoord.z);"));b.J===w.lf&&l.b("gl_Position.z += 0.025;");(b.hb||0<b.ga)&&b.i.forEach(function(u,v){var C=u.usage;if(0!==C){var D=C&w.Ld;C&=w.Hd;var F=u.jj;if(0!==C&&C!==w.Id){var J="@UV"+F,M="uv"+v;l.je(J)||l.g(J,"vec2",
"uv"+F,w.Va+F);if(0==D)l.a("vec2 "+M+" = "+J+";");else{h(l);F="@UV_DELTA"+v;l.g(F,"vec4","uv_ramp"+v,w.Ec+v);var O="@UV_V"+v;if(D===w.Ed)l.pa(O,"vec2","uv_varying"+v),l.b((O+" = "+J+" + vec2(floor(mod(!DELTA!.x * dt + !DELTA!.y, !DELTA!.z)/!DELTA!.w) * !DELTA!.w,0);").replace(/!DELTA!/g,F)),l.a("vec2 "+M+" = "+O);else if(D===w.Ic)D="@UV_BOUNDS"+v,l.g(D,"vec4","uv_bounds"+v,w.Kb+v),q(l),l.a(("vec2 "+M+" = mod(!DELTA!.xy * dt + "+J+" -!BOUND!.xy, !BOUND!.zw) + !BOUND!.xy;").replace(/!BOUND!/g,D).replace(/!DELTA!/g,
F));else if(D===w.bf)D="@UV_BOUNDS"+v,l.pa(O,"vec2","uv_varying"+v),l.g(D,"vec4","uv_bounds"+v,w.Kb+v),l.b((O+" = clamp("+J+" + !DELTA!.xy * dt, !BOUND!.xy, !BOUND!.zw);").replace(/!BOUND!/g,D).replace(/!DELTA!/g,F)),l.a("vec2 "+M+" = "+O);else throw Error();}D="@TEXTURE"+v;l.l(D,"sampler2D","texture"+v);if(C===w.Ng||w.Og)l.a("{"),l.a("vec4 rgba = texture2D("+D+","+M+");"),l.a("if (rgba.a < 0.01){discard;};"),l.a("}")}}});return l});z.$o=new c(function(b){return(b.Uc?"s":"0")+(b.hb?"t":"0")+(b.ga?
(100*b.ga).toFixed(0):"0")+(b.J.toFixed(0)+",")+(b.u.toFixed(0)+",")},function(b){if(!1===b.Uc||b.hb||b.J===w.Gd)return null;var l=new H(I);l.g("@POS","vec3","position",w.ba);r(l,b,!1);Ia(B,"WEBGL_depth_texture")?(l.b("gl_Position = @P_MAT * posVS;"),l.a("gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);")):(l.b("gl_Position = @P_MAT * posVS;"),l.a("gl_FragColor = @@PACK_FLOAT(gl_FragCoord.z);"));return l});z.Gp=new c(function(b){return b.J.toFixed(0)+","+(b.u.toFixed(0)+",")},function(b){var l=new H(I);l.g("@POS",
"vec3","position",w.ba);l.g("@NORMAL","vec3","normal",w.Lb);r(l,b,!1,{cl:!0});l.b("gl_Position = @P_MAT * posVS;");l.a("gl_FragColor = vec4(122.0/255.0, 82.0/255.0, 48.0/255.0, 1.0);");return l});z.Bp=new c(function(b){return b.u.toFixed(0)+","+((b.i[0]?b.i[0].usage.toFixed(0):"0")+",")+((b.i[1]?b.i[1].usage.toFixed(0):"0")+",")+((b.i[2]?b.i[2].usage.toFixed(0):"0")+",")+((b.i[3]?b.i[3].usage.toFixed(0):"0")+",")},function(b){var l=new H(I);l.g("@POS","vec3","position",w.ba);l.g("@NORMAL","vec3",
"normal",w.Lb);l.g("@FRAG_POS","vec3","pos_vs");l.g("@NORMAL_INTERP","vec3","normal_vs");r(l,b,!0);g(l,b);l.b("gl_Position = @P_MAT * posVS;");l.a("gl_FragColor = @@PACK_NORMALS(N);");return l});z.pd=new c(function(b){return(b.hd?"i":"0")+(b.vd?"r":"0")+(b.fc?"e":"0")+(b.nj?"w":"0")+(b.Me?"l":"0")+(b.Ta?"c":"0")+(b.ta?"s":"0")+(b.u.toFixed(0)+",")+(b.Uc?"c":"0")+(b.Ti?"r":"0")+(b.hb?"m":"0")+(b.ga?(100*b.ga).toFixed(0):"0")+(0<b.Hh?"f":"0")+(b.Zh+",")+(b.Nc?"S":"0")+(b.J.toFixed(0)+",")+((b.i[0]?
b.i[0].usage.toFixed(0):"0")+",")+((b.i[1]?b.i[1].usage.toFixed(0):"0")+",")+((b.i[2]?b.i[2].usage.toFixed(0):"0")+",")+((b.i[3]?b.i[3].usage.toFixed(0):"0")+",")},function(b){var l=new H(I);l.g("@POS","vec3","position",w.ba);l.g("@NORMAL","vec3","normal",w.Lb);l.pa("@FRAG_POS","vec3","pos_vs");l.pa("@NORMAL_INTERP","vec3","normal_vs");var u=!1;!0===b.Me?u=!0:b.J===w.Gd&&(u=!0);r(l,b,u);l.b("gl_Position = @P_MAT * posVS;");l.l("@MATERIAL","Material","material");l.a("Material material;");l.g("@UV",
"vec2","uv",w.Va);u=b.Zh&w.Ld;u===w.Ed?(h(l),l.g("@UV_RAMP","vec4","uv_ramp",w.wj),l.g("@UV_BASE","vec2","uv_base",w.Va),l.pa("@UV","vec2","uv_varying"),l.b("vec2 uv = @UV_BASE;\nuv.x += floor(mod(@UV_RAMP.x * dt + @UV_RAMP.y, @UV_RAMP.z)/@UV_RAMP.w)*@UV_RAMP.w;\n@UV = uv;"),l.a("vec2 uv_ = @UV;")):u===w.Ic&&(h(l),l.g("@UV_BASE","vec2","uv_base",w.Va),l.g("@UV_BOUNDS","vec4","uv_bounds",w.Kb),l.g("@UV_DELTA","vec2","uv_delta",w.Ec),l.pa("@DT","float","dt"),l.b("@DT = dt;"),l.a("float dt = @DT;\nvec2 uv_ = mod(@UV_DELTA * dt + @UV_BASE - @UV_BOUNDS.xy, @UV_BOUNDS.zw) + @UV_BOUNDS.xy;"));
b.Ta&&(l.g("@VERT_COLOR","vec4","vert_color",w.We,Uint8ClampedArray,!0),l.a("material.baseColor = @VERT_COLOR;"));b.ta&&(l.g("@VERT_SURF","vec2","vert_surf",w.Xe,Uint8ClampedArray,!0),l.a("material.smoothness = @VERT_SURF.x;"),l.a("material.metalness = @VERT_SURF.y;"));b.i.forEach(function(F,J){f(l,b,F,J)});l.a("vec4 color = vec4(0.0, 0.0, 0.0, material.baseColor.a);");if(b.J===w.Gd)g(l,b),l.a("vec3 V = normalize(-@FRAG_POS);\nfloat NdotV = max(dot(N,V), 0.0);\ncolor = material.baseColor;\ncolor.rgb *= NdotV * NdotV;\ncolor.rgb *= min(length(@FRAG_POS)-1.0, 1.0);");
else if(b.Me){b.ga?l.a("if (material.baseColor.a < "+b.ga.toFixed(2)+"){discard;};"):b.hb&&(b.u&w.nf||b.u&w.Jd)&&l.a("if (material.baseColor.a < 0.2){discard;};");l.l("@GAMMA","float","gamma");g(l,b);l.a("vec3 V = normalize(-@FRAG_POS);\nfloat NdotV = max(dot(N,V), 0.0);\nvec3 directDiffuse = vec3(0.0);\nvec3 directSpec = vec3(0.0);\nvec3 indirectDiffuse = vec3(0.0);\nvec3 indirectSpec = vec3(0.0);\nfloat roughness = 1.0 - material.smoothness*0.98;\nfloat metalness = material.metalness;\nfloat alpha = roughness * roughness;\nvec3 baseColor = material.baseColor.rgb;\nbaseColor.rgb = pow(baseColor.rgb, vec3(@GAMMA));\nvec3 diffuseColor = mix(baseColor, vec3(0.0), metalness);\nvec3 specColor = mix(vec3(0.04), baseColor, metalness);");
b.Nc&&l.a("alpha = mix(alpha, roughness, 0.3);");b.hb&&l.a("float transparency = min(material.baseColor.a, 1.0);\ndiffuseColor *= transparency;\nspecColor *= transparency;");var v=d.Db;u=v.Zi.length;var C=v.si.length;v.th&&(I.bc("LightCascadeShadowed",{light_pos:"vec4",light_color:"vec4",light_dir:"vec4",const_linear_quadratic:"vec4",cascade_dists:"vec4",shadow_texel:"vec2"}),l.l("@LIGHT_CASCADED_SHADOWED","LightCascadeShadowed","light_cascade_shadowed"),l.l("@CASCADED_SHADOW","sampler2D","cascaded_shadow_map"),
l.Df("@CASCADE_MATS","mat4","cascade_mats",4),l.a("{"),l.a("vec4 cascade_dists = @LIGHT_CASCADED_SHADOWED.cascade_dists;"),l.s("@@INSIDE_CUBE","insideCube","float insideCube(vec3 v){\n    vec3 s = step(vec3(0.0), v) - step(vec3(1.0), v);\n    return s.x * s.y * s.z;\n}"),l.s("@@CALC_COORDS","calcCOORDS","vec3 calcCOORDS(mat4 lightMatrix, vec3 fragPos, out vec4 fragLight){\n   fragLight = lightMatrix * vec4(fragPos, 1.0);\n   vec3 projCoords = fragLight.xyz/fragLight.w;\n   projCoords = projCoords * 0.5 + 0.5;\n   return projCoords.xyz;\n}"),
l.a("vec4 fragLight;\nint index;\nif (@@INSIDE_CUBE(@@CALC_COORDS(@CASCADE_MATS[0], @FRAG_POS, fragLight)) == 1.0){\n   index = 0;\n} else if (@@INSIDE_CUBE(@@CALC_COORDS(@CASCADE_MATS[1], @FRAG_POS, fragLight)) == 1.0){\n   index = 1;\n} else if (@@INSIDE_CUBE(@@CALC_COORDS(@CASCADE_MATS[2], @FRAG_POS, fragLight)) != 0.0){\n   index = 2;\n} else if (@@INSIDE_CUBE(@@CALC_COORDS(@CASCADE_MATS[3], @FRAG_POS, fragLight)) != 0.0){\n   index = 3;\n}"),p(l,b,!0,"@LIGHT_CASCADED_SHADOWED","@CASCADED_SHADOW",
"index"),l.a("}"));if(0<u)if(I.bc("LightShadowed",{light_pos:"vec4",light_color:"vec4",light_dir:"vec4",const_linear_quadratic:"vec4",light_matrix:"mat4",shadow_texel:"vec2"}),1<u)for(l.Df("@LIGHT_S","LightShadowed","light_s",u),v=0;v<u;v++){l.l("@SHADOW"+v.toFixed(0),"sampler2D","shadow_map"+v.toFixed(0));var D="@LIGHT_S["+v.toFixed(0)+"]";l.a("{");l.a("   vec4 fragLight = "+D+".light_matrix * vec4(@FRAG_POS,1.0);");p(l,b,!0,"@LIGHT_S["+v.toFixed(0)+"]","@SHADOW"+v.toFixed(0));l.a("}")}else 1===
u&&(l.l("@LIGHT_S","LightShadowed","light_s"),l.l("@SHADOW","sampler2D","shadow_map"),l.l("@LIGHT_MAT","mat4","light_matrix"),l.g("@FRAG_LIGHT","vec4","fragLight"),l.a("{"),l.b("@FRAG_LIGHT = @LIGHT_MAT * vec4(posVS.xyz,1.0);"),l.a("vec4 fragLight = @FRAG_LIGHT;"),p(l,b,!0,"@LIGHT_S","@SHADOW"),l.a("}"));1<C?(l.Df("@LIGHT","Light","light",C),l.a("const int MAX_LIGHTS = "+C.toFixed(0)+";"),l.a("for (int i = 0; i < MAX_LIGHTS; i++){"),p(l,b,!1,"@LIGHT[i]"),l.a("}")):1===C&&(l.l("@LIGHT","Light","light"),
p(l,b,!1,"@LIGHT"));m(l,b);d.Db.cj.cb&&(l.l("@SSAO_TEXTURE","sampler2D","ssaoTexture"),l.a("vec2 texCoord = gl_FragCoord.xy*@INV_RES;\nfloat occlusion = texture2D(@SSAO_TEXTURE, texCoord).r;"),b.Nc&&l.a("occlusion = 0.5 + occlusion*0.5;"),l.a("indirectDiffuse *= 0.5 + 0.5 * occlusion;\nindirectSpec *= 0.5 + 0.5 * occlusion;\ndirectDiffuse *= (0.75 + 0.25 * occlusion);\ndirectSpec *= (0.75 + 0.25 *occlusion);"));l.a("color.rgb = directDiffuse + indirectDiffuse + indirectSpec + directSpec;");d.Db.Gf.cb&&
(l.l("@FOG_COLOR_DIST","vec4","fogColorDist"),l.a("float vertDist = length(@FRAG_POS);"),l.a("float FOG_MAX_DIST = @FOG_COLOR_DIST.a;"),l.a("float fogR = 1.0 - clamp((FOG_MAX_DIST - vertDist)/(FOG_MAX_DIST - FOG_MAX_DIST*0.2), 0.0, 1.0);"),l.a("color.rgb = mix(color.rgb, @FOG_COLOR_DIST.rgb * color.a * color.a, fogR);"));b.J===w.lf&&l.a("if (color.a < 1.0){\n   color.rgb /= color.a;\n   color.a = 1.0;\n}");l.a("color.rgb = pow(color.rgb, vec3(1.0/@GAMMA));")}else l.a("color = material.baseColor;"),
b.ga&&l.a("if (material.baseColor.a < "+b.ga.toFixed(2)+"){discard;};");b.J===w.Rj&&l.a("color.rgba *= max(0.0, 1.7 - @POS.y);");b.nj&&(l.g("@BCOORD","vec3","barycentric",w.Se),Ia(B,"OES_standard_derivatives")?(l.Gh("#extension GL_OES_standard_derivatives : enable"),l.s("@@EDGE_FACTOR","edge_factor","float edge_factor(vec3 vBC){\n   vec3 d = fwidth(vBC);\n   vec3 a3 = smoothstep(vec3(0.0),d*0.75, vBC);\n   return min(min(a3.x, a3.y),a3.z);\n   }"),l.a("color = mix(vec4(0.0, 0.0, 0.0, 1.0), color, @@EDGE_FACTOR(@BCOORD));")):
(l.a("if(any(lessThan(@BCOORD, vec3(0.012)))){"),l.a("   color = vec4(0.0, 0.0, 0.0, 1.0);"),l.a("}")));0<b.Hh&&(h(l),l.g("@FADING","float","fade",w.tj),l.pa("@FADING_MULT","float","fading_mult"),l.b("@FADING_MULT = (1.0 - @FADING * dt);"),l.a("color *= @FADING_MULT;"));b.Me&&l.a("vec2 ssUV = gl_FragCoord.xy*@INV_RES;\ncolor.rgb += mix(-0.5/255.0, 0.5/255.0, @@NOISE2(ssUV * 1000.0));");l.a("gl_FragColor = color;");return l});a.Bj=function(){};a.Bj.prototype={};a.Fd=function(b){this.h={rd:-1,kq:null};
this.fc=this.vd=this.hd=null;this.Ti=this.Uc=!0;this.Hh=-1;this.He=0;this.i=[];this.mh=-1;this.Nc=!1;this.J=0;this.nj=!1;this.u=d.pb.Rg;this.Zh=0;this.Me=!0;this.ta=this.Ta=!1;this.um=!0;this.hb=!1;this.ga=0;this.Ea=this.Qd=this.Zc=null;Object.preventExtensions(this);if(b){var l=!1===b instanceof d.Fd;T.la.Xi(this,b);if(l){if(this.Ta&&this.Ta.length)for(b=0;4>b;b++)this.Ta[b]=Math.round(this.Ta[b]);this.ta&&2<this.ta.length&&(b=this.ta,this.ta=new Uint8Array(2),this.ta[0]=b[0],this.ta[1]=b[1])}}};
a.Fd.prototype={Ph:function(){this.Si();if(this.Qd)return this.Qd;var b=this.u&w.Jd||this.u&w.nf?!0:!1;return this.Qd=z.pd.Uh(this).nl(b)},Si:function(){if(this.Zc)return this;this.i.forEach(function(C){if(0!==C.usage&&!C.Eb)throw Error();});var b=this.i[0]?this.i[0].Eb:null;if(b)for(var l=1,u=this.i.length;l<u;l++){var v=this.i[l];v.usage=this.Lk(v.usage,b,v.Eb,l)}this.te(0);this.te(1);this.te(2);this.te(3);this.Zc=z.pd.Yi(this);return this},Lk:function(b,l,u){if(0===b||!u||l.ji&&u.ji)return b;if(.001<
Math.abs(l.Ha-u.Ha)||.001<Math.abs(l.nb-u.nb)||.001<Math.abs(l.Sa-u.Sa)||.001<Math.abs(l.Fb-u.Fb))b|=w.mk;return b},te:function(b){var l=this.i[b];if(l){var u=d.pb;if((l.usage&u.Hd)===u.Id){if(0<=this.h.rd)throw Error();this.h.rd=b}}},uc:function(b,l){if(b)if(b.Eb&&(b=b.Eb),b.L)b=b.L;else if(b.Pf)b=b.Pf;else throw console.log(b,l),Error();if(l)if(l.Eb&&(l=l.Eb),l.L)l=l.L;else if(l.Pf)l=l.Pf;else throw Error();return b===l},Bl:function(b){return this.mh===b.mh&&this.uc(this.i[0],b.i[0])&&this.uc(this.i[1],
b.i[1])&&this.uc(this.i[2],b.i[2])&&this.uc(this.i[3],b.i[3])&&this.uc(this.hd,b.hd)&&this.uc(this.vd,b.vd)&&this.fc===b.fc},xh:function(){return new d.Fd(this)},toJSON:function(){return null}};a.ef=function(b){this.D=b.Ph();this.md=b;this.wa=new E.Dg(this.D)};a.ef.prototype={eh:function(b,l,u){var v=this.wa;if(u){b=this.D.X;0<=b[w.Ve]&&!u.Je&&Ga(u);0<=b[w.Se]&&!u.Xd&&Fa(u);if(b[w.Va]&&(!u.aa||0===u.aa.length)){b=[];l=0;for(var C=u.B;l<C;l++)b[2*l]=.5,b[2*l+1]=.5;Ea(u,b)}b=u.B;l=u.R}return v.wd(b,
l)}};a.Qn=k;k.prototype={Ca:function(){if(this.Qa||0===this.Qa){var b=16*this.Qa,l=A.N,u=this.c,v=this.F,C=this.m,D=v[0],F=v[1],J=v[2],M=v[3],O=D+D,N=F+F,Q=J+J;v=D*O;var S=D*N;D*=Q;var Z=F*N;F*=Q;J*=Q;O*=M;N*=M;M*=Q;Q=C[0];var U=C[1];C=C[2];l[b]=(1-(Z+J))*Q;l[b+1]=(S+M)*Q;l[b+2]=(D-N)*Q;l[b+3]=0;l[b+4]=(S-M)*U;l[b+5]=(1-(v+J))*U;l[b+6]=(F+O)*U;l[b+7]=0;l[b+8]=(D+N)*C;l[b+9]=(F-O)*C;l[b+10]=(1-(v+Z))*C;l[b+11]=0;l[b+12]=u[0];l[b+13]=u[1];l[b+14]=u[2];l[b+15]=1;A.mb.O=!0}},animate:function(b){0<=this.ma&&
this.ad();b=ANIM_SYSM.pm(this,b);this.ma=b.pl();return b},ad:function(){if(!(0>this.ma)){var b=this.ma;this.ma=-1;ANIM_SYSM.al(b)}},yd:function(b){if(b!==this.visible){var l=this.h.rc,u=l.wa,v=l.ab;l=l.ab+l.xb;b?u.fe.ai(v,l):u.fe.removeRange(v,l);this.visible=b;return this}},Hf:function(){var b=this.h.rc;this.h.rc=null;b.wa.kl(b);void 0!==this.Qa&&A.If(this.Qa);this.c&&(d.sc.Mh(ba,this.c),this.c=null);this.m&&(d.sc.Mh(ba,this.m),this.m=null);this.F&&(d.sc.Mh(ka,this.F),this.F=null);this.ad()}};n.prototype=
k.prototype;t.prototype={Ca:function(){if(!1!==0<=this.zc){var b=16*this.zc,l=A.N,u=this.c,v=this.F,C=this.m,D=v[0],F=v[1],J=v[2],M=v[3],O=D+D,N=F+F,Q=J+J;v=D*O;var S=D*N;D*=Q;var Z=F*N;F*=Q;J*=Q;O*=M;N*=M;M*=Q;Q=C[0];var U=C[1];C=C[2];l[b]=(1-(Z+J))*Q;l[b+1]=(S+M)*Q;l[b+2]=(D-N)*Q;l[b+3]=0;l[b+4]=(S-M)*U;l[b+5]=(1-(v+J))*U;l[b+6]=(F+O)*U;l[b+7]=0;l[b+8]=(D+N)*C;l[b+9]=(F-O)*C;l[b+10]=(1-(v+Z))*C;l[b+11]=0;l[b+12]=u[0];l[b+13]=u[1];l[b+14]=u[2];l[b+15]=1;A.mb.O=!0}},yd:function(b){if(b!==this.visible){this.visible=
b;for(var l=0,u=this.gb.length;l<u;l++)this.gb[l].yd(b);return this}},Hf:function(){for(var b=0,l=this.gb.length;b<l;b++){var u=this.gb[b];u.Qa===this.zc&&(u.Qa=void 0);u.Hf()}0<=this.zc&&A.If(this.zc);this.gb.length=0;this.ad()},animate:function(b){0<=this.ma&&this.ad();b=ANIM_SYSM.pm(this,b);this.ma=b.pl();return b},ad:function(){if(!(0>this.ma)){var b=this.ma;this.ma=-1;ANIM_SYSM.al(b)}}};a.eo=e;e.prototype=Object.create(k.prototype);e.prototype.Nd=function(b,l){return b*this.h.wh-l*this.h.$i};
e.prototype.Od=function(b,l){return b*this.h.$i+l*this.h.wh};e.prototype.Ca=function(){var b=this.h.rc,l=b.wa;b=b.pg;l.Qe(w.Fc,b,this.c);l.Qe(w.Fc,b+1,this.c);l.Qe(w.Fc,b+2,this.c);l.Qe(w.Fc,b+3,this.c);if(this.h.O){if(l.ki(w.ba)){var u=this.m[0]/2,v=this.m[1]/2,C=this.h.$f,D=this.h.ag,F=this.h.Tl;l.ob(w.ba,b,this.Nd(u+C,v+D),this.Od(u+C,v+D),F);l.ob(w.ba,b+1,this.Nd(-u+C,v+D),this.Od(-u+C,v+D),F);l.ob(w.ba,b+2,this.Nd(-u+C,-v+D),this.Od(-u+C,-v+D),F);l.ob(w.ba,b+3,this.Nd(u+C,-v+D),this.Od(u+C,-v+
D),F)}this.h.Ie&&(u=this.h.Ie[0],v=this.h.Ie[1],C=this.h.Ie[2],l.ob(w.Jb,b,u,v,C),l.ob(w.Jb,b+1,u,v,C),l.ob(w.Jb,b+2,u,v,C),l.ob(w.Jb,b+3,u,v,C))}return this};e.prototype.km=function(b){var l=b/this.m[1];this.h.$f*=32/this.m[0];this.h.ag*=l;this.m[0]=32;this.m[1]=b;this.h.O=!0;this.Ca()};(function(){var b=new T.Ob,l=[.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,-.5,0];if(0<b.B&&l.length/3!==b.B)throw Error();b.ka=l;b.B=l.length/3;l=[0,0,1,0,0,1,0,0,1,0,0,1];if(0<b.B&&l.length/3!==b.B)throw Error();b.ja=l;b.B=l.length/
3;Ea(b,[1,0,0,0,0,1,1,1]);b.ha=[0,1,2,0,2,3];b.R=b.ha.length;return b})();a.Ij=function(){this.Dh=new d.Zb.Qb(this.nk)};a.Ij.prototype={Jh:function(b){b.Zc||b.Si();var l=this.Dh.vl(b);l||(l={He:b.He,jg:[],ig:new Map},this.Dh.bb(l));var u=b.Zc;if(!l.ig.has(u)){var v=l.jg.length;l.jg[v]=[];l.ig.set(u,v)}l=l.jg[l.ig.get(u)];return this.gl(l,b)},gl:function(b,l){if(!l.um)return C=new a.ef(l),b.push(C),C;for(var u=0,v=b.length;u<v;u++){var C=b[u];if(C.md.Bl(l))return C}C=new a.ef(l.xh());b.push(C);return C},
Rl:function(b,l,u){if(!b)throw Error();if(!l)throw Error();var v=this.Jh(l).eh(b.B,b.R,b);return new k(v,b,l,u)},Ql:function(b,l,u){var v=b.qd;if(!v)throw Error();l=l?l:b.yi;if(!l)throw Error();if(l instanceof a.Fd){var C=l;l={};b.nd.forEach(function(U){l[U]=C})}b=b.nd;var D=new t(this,u),F=D.h.gb;if(!u)var J=D.zc;var M;var O=0;for(M=v.length;O<M;O++){var N=v[O],Q=b[O],S=l[Q];if(!S)throw Error(Q);var Z=S.Ea?S.Ea:this;N=u?u.Gk(N,S,S.Ea?S.Ea:null):Z.Rl(N,S,J);F[O]=N;l[Q]=N.md}return D},nk:function(b,
l){return l.He-b.He}};a.bn=x;x.prototype={f:function(b){this.La=b.La;this.wf=b.wf;this.sd=b.sd;this.Yb=b.Yb;this.Tc=b.Tc;this.Ba.f(b.Ba);this.ra.f(b.ra);b.ea&&!this.ea&&(this.ea=new R(1,1,1));this.ea&&b.ea&&this.ea.f(b.ea);this.c.f(b.c);this.F.f(b.F);b.m&&!this.m&&(this.m=new R(1,1,1));this.m&&b.m&&(this.m.f(b.m),this.fa=this.m);this.ve.f(b.ve);this.xe.f(b.xe);this.ue.f(b.ue);this.we.f(b.we);return this},Le:function(b){if(this.le){if(8===b.Uk){var l=da(va().f(this.le).Ya(this.T),this.K),u=Ca().Z(this.T,
this.me).normalize(),v=8*this.Yb,C=b.N,D=u[0],F=u[1],J=u[2];u=u[3];var M=l[0],O=l[1];l=l[2];C[v]=D;C[v+1]=F;C[v+2]=J;C[v+3]=u;C[v+4]=.5*(M*u+O*J-l*F);C[v+5]=.5*(-M*J+O*u+l*D);C[v+6]=.5*(M*F-O*D+l*u);C[v+7]=-.5*(M*D+O*F+l*J)}else{sa(this.oj,this.fa,this.T,this.K);var N=this.oj;v=this.nc;C=16*this.Yb;D=b.N;F=N[0];J=N[1];l=N[2];u=N[3];M=N[4];O=N[5];var Q=N[6],S=N[7],Z=N[8],U=N[9],ha=N[10],ja=N[11],pa=N[12],qa=N[13],Aa=N[14];N=N[15];var V=v[0],W=v[1],X=v[2],Y=v[3];D[C]=V*F+W*M+X*Z+Y*pa;D[C+1]=V*J+W*O+
X*U+Y*qa;D[C+2]=V*l+W*Q+X*ha+Y*Aa;D[C+3]=V*u+W*S+X*ja+Y*N;V=v[4];W=v[5];X=v[6];Y=v[7];D[C+4]=V*F+W*M+X*Z+Y*pa;D[C+5]=V*J+W*O+X*U+Y*qa;D[C+6]=V*l+W*Q+X*ha+Y*Aa;D[C+7]=V*u+W*S+X*ja+Y*N;V=v[8];W=v[9];X=v[10];Y=v[11];D[C+8]=V*F+W*M+X*Z+Y*pa;D[C+9]=V*J+W*O+X*U+Y*qa;D[C+10]=V*l+W*Q+X*ha+Y*Aa;D[C+11]=V*u+W*S+X*ja+Y*N;V=v[12];W=v[13];X=v[14];Y=v[15];D[C+12]=V*F+W*M+X*Z+Y*pa;D[C+13]=V*J+W*O+X*U+Y*qa;D[C+14]=V*l+W*Q+X*ha+Y*Aa;D[C+15]=V*u+W*S+X*ja+Y*N}b.Ca()}},oh:function(){this.nc&&ra(sa(this.nc,this.fa,this.T,
this.K));var b=this.me.f(this.T);b[0]=-b[0];b[1]=-b[1];b[2]=-b[2];this.le.f(this.K).scale(-1).Ya(this.me)},Il:function(b,l){this.qh(b,l,this.Ba,this.ra,this.ea)},Ol:function(b,l,u){0<=u&&(this.xe.f(this.ra),this.ve.f(this.Ba),this.Il(b,u),this.we.f(this.ra),this.ue.f(this.Ba));this.Ba.Cb(this.ve,this.ue,l);ma(this.ra,this.xe,this.we,l);if(DEV&&isNaN(this.ra[0]))throw console.log(this),Error();},qh:function(b,l,u,v,C){var D=b.ul(l),F=b.Rh(D);b=b.Rh(D+1);D=F.t;var J=b.t;D===J?(u.f(F.c),v.f(F.F)):(l=
(l-D)/(J-D),u.Cb(F.c,b.c,l),ma(v,F.F,b.F,l),C&&F.m&&b.m&&C.Cb(F.m,b.m))},$d:function(){var b=this.sd,l=this.Ba,u=this.ra;this.fa.Z(b.fa,this.ea);this.K.Z(l,b.fa);this.K.Ya(b.T);da(this.K,b.K);this.T.Z(b.T,u)}};y.prototype=T.la.Sb(Pa.prototype,{tq:function(b,l,u){var v=this.H;a:{var C=this.h;if(!(C.pe>=l)&&(C.pe=l,C.$c=b,this.Ub)){0<this.na?(this.na-=b,b*=this.Pc):0<this.ua&&(this.ua-=b,b*=this.Sd);if(0<this.Da){if(this.ia+b<this.Da){0!==this.ia&&(C.ye=-1);this.ia+=b;C.t=this.ia/this.Da;break a}this.C=
this.ia;this.Da=-1}this.C+=b*this.ca;if(this.C>this.Xa||this.C<this.va)if(this.Vb===this.Re)this.C=this.va+T.j.Ai(this.C,this.Xa-this.va);else if(this.Vb===this.qg)this.C=T.j.oa(this.C,this.va,this.Xa),this.ca=-this.ca;else if(this.Vb===this.rg)this.ca=0,this.C=T.j.oa(this.C,this.va,this.Xa);else throw Error();C.t=0!==this.rb?this.C/this.rb:0;if(1<C.t||0>C.t)if(console.log(this),DEV)throw Error();this.Tb&&this.Tb.Hk.sm(this.Tb,this.Td,C.t)}}if(u||0<this.Da){l=0;for(u=this.H.length;l<u;l++)b=v[l],
b.Ka&&b.Ka.enabled?b.Ka.Qf(b,b.Tc,this):Qa(this,b,this.Ub);l=this.F;u=0;for(b=v.length;u<b;u++)v[u].Le(this.Fa,l)}},uq:function(b,l){var u=this.H;Ra(this,b,l);var v;var C=0;for(v=u.length;C<v;C++){var D=u[C];D.Ka&&D.Ka.enabled?D.Ka.Qf(D,C,this):Qa(this,D,this.Ub)}var F=this.F;C=0;for(v=u.length;C<v;C++)D=u[C],D.Le(this.Fa,F)},sq:function(){var b=this.H,l;var u=0;for(l=b.length;u<l;u++){var v=b[u];v.Ka&&v.Ka.enabled?v.Ka.Qf(v,u,this):Qa(this,v,this.Ub)}var C=this.F;u=0;for(l=b.length;u<l;u++)v=b[u],
v.Le(this.Fa,C)},Ho:function(b,l){if(!(l>b))throw Error();this.na=b;this.Pc=0;this.ua=l-b;this.Sd=l/(l-b)*this.ca},Io:function(b,l,u){if(!(u>b))throw Error();b=this.C;u*=this.rb;this.na=l*this.rb;this.Pc=.3*this.ca;this.ua=(u-b)/this.ca-this.na;this.Sd=(this.ca*(u-b)-this.na*this.Pc)/this.ua},aj:function(b){b=b?this.H:this.U;for(var l=0,u=b.length;l<u;l++)b[l].$d()},xq:function(){for(var b=this.U,l=0,u=b.length;l<u;l++)b[l].Le(this.Fa,this.F)},bj:function(b,l){ia(this.c,0,0,0);this.F.wb();var u=this.U,
v=ua();if(this.Na)for(var C=0,D=u.length;C<D;C++){var F=u[C];if(F){var J=v,M=F.me,O=F.le,N=M[0],Q=M[1],S=M[2],Z=M[3],U=N+N,ha=Q+Q,ja=S+S;M=N*U;var pa=N*ha;N*=ja;var qa=Q*ha;Q*=ja;S*=ja;U*=Z;ha*=Z;Z*=ja;J[0]=1-(qa+S);J[1]=pa+Z;J[2]=N-ha;J[3]=0;J[4]=pa-Z;J[5]=1-(M+S);J[6]=Q+U;J[7]=0;J[8]=N+ha;J[9]=Q-U;J[10]=1-(M+qa);J[11]=0;J[12]=O[0];J[13]=O[1];J[14]=O[2];J[15]=1;ra(v);ta(v,null,F.T,F.K);l||ia(F.m,1,1,1);b&&da(F.K,b)}}else for(C=0,D=u.length;C<D;C++)if(F=u[C])v.f(F.nc),ra(v),ta(v,F.fa,F.T,F.K),b&&
da(F.K,b)},yf:function(b){b=b?this.U:this.H;for(var l=0,u=b.length;l<u;l++){var v=b[l];v&&(v.$d(),v.oh())}},im:function(b){b=b?this.U:this.H;for(var l=0,u=b.length;l<u;l++){var v=b[l];v&&(v.$d(),v.oh(),v.rf.f(v.nc))}},rm:function(b){ia(this.c,0,0,0);this.F.wb();for(var l=this.U,u=ua(),v=0,C=l.length;v<C;v++){var D=l[v];D&&(u.f(D.rf),ra(u),ta(u,D.fa,D.T,D.K),b&&da(D.K,b))}},ph:function(b,l){if(this.Na){var u=this.U.length;if(!this.$b){this.$b=[];for(var v=0;v<u;v++)this.$b[v]=new P}v=va();va();var C=
Ca(),D=va();ua();if(b)for(var F=0;F<u;F++){var J=this.U[F],M=this.$b[F];sa(M,J.fa,J.T,J.K);M.Z(M,J.rf);l&&"weapon_handle_R"===J.La&&(ta(M,v,C,D),console.log(v,C,D,this))}else for(F=0;F<u;F++)J=this.U[F],M=this.$b[F],sa(M,J.fa,J.T,J.K),M.Z(M,J.nc)}},$p:function(b){if(null===this.Td)throw Error();this.ca=0<b?1:-1;this.rb=b=Math.abs(b);this.na=this.ua=0;return b},hp:function(){return this.Td},sk:function(b,l,u){this.Na&&l.u!==w.Kd?l.u=w.Kd:this.Na||l.u===w.pf||(l.u=w.pf);u=u.Jh(l).eh(b.B,b.R,b);return new n(u,
b,l,this.U,this.$b)},Gk:function(b,l,u){if(!b)throw Error();u||(u=this.Ea);return b.ci?u.Ql(b,l,this):this.sk(b,l,u)},No:function(b){this.rm();return 1!==this.m[0]?(b=new y(this.Ea,b,this.Na,this),b.Na?(b.im(!1),this.aj(),this.bj(null,!0),b.aj(!0),b.ph(!0),b.yf(!1)):(b.yf(),b.ph(!0)),b):new y(this.Ea,b,this.Na,this)},iq:function(b,l){this.bj();var u=new Set;if(b===l)u.add(this.he(b));else{var v=!1;this.U.forEach(function(C){if(!v){var D=C.La;(D===b||u.has(C.sd))&&u.add(C);l&&D===l&&(v=!0)}})}return new y(this.Ea,
this.Nl,this.Na,this,u)},Qh:function(b){return this.Wa.Ro[b]},he:function(b){return this.U[this.Qh(b)]},gp:function(b,l){var u=this.Wa.fh[b],v=this.Qh(l);return u?u[v]:null},yp:function(){return new Sa(this.Wa.fh)},ep:function(){for(var b=0,l=this.H.length;b<l;b++){var u=this.H[b];u&&this.Fa.If(u.Yb)}}})});
function Pa(a,d){this.Ub=null;this.Td="";this.ca=1;this.C=0;this.rb=-1;this.Xa=this.va=0;this.Vb=this.Re;this.ia=this.Da=-1;this.Sd=this.ua=this.Pc=this.na=0;this.Tb=d?d.Wo():null;this.h={$c:0,t:0,ye:-1,tp:-1,sp:-1,pe:-1}}function Qa(a,d,e){var c=a.h;e&&(0<a.Da?d.Ol(e[d.Tc],c.t,c.ye):d.qh(e[d.Tc],c.t,d.Ba,d.ra,null));d.$d()}
function Ra(a,d,e){var c=a.h;if(!(c.pe>=e)&&(c.pe=e,c.$c=d,a.Ub)){0<a.na?(a.na-=d,d*=a.Pc):0<a.ua&&(a.ua-=d,d*=a.Sd);if(0<a.Da){if(a.ia+d<a.Da){0!==a.ia&&(c.ye=-1);a.ia+=d;c.t=a.ia/a.Da;return}a.C=a.ia;a.Da=-1;a.h.ye=-1}a.C+=d*a.ca;if(a.C>a.Xa||a.C<a.va)if(a.Vb===a.Re)a.C=a.va+T.j.Ai(a.C,a.Xa-a.va);else if(a.Vb===a.qg)a.C=T.j.oa(a.C,a.va,a.Xa),a.ca=-a.ca;else if(a.Vb===a.rg)a.ca=0,a.C=T.j.oa(a.C,a.va,a.Xa);else throw Error();c.t=0!==a.rb?a.C/a.rb:0;if(1<c.t||0>c.t)throw console.log(a),Error();a.Tb&&
a.Tb.Hk.sm(a.Tb,a.Td,c.t)}}Pa.prototype={Bo:new R,Do:new xa,Eo:new R,Co:new R,Re:0,qg:1,rg:2};function Sa(a){Pa.call(this,a)}Sa.prototype=T.la.Sb(Pa.prototype,{Qf:function(a){Qa(this,a,this.Ub);if(DEV&&isNaN(a.c[0]))throw console.log(this,a),Error();},vq:function(a,d){Ra(this,a,d)}});T.Kc=function(a,d){this.Oc=a;this.Wg=ra(new P(a));this.Rd=d;this.vk=(new P).Z(d,a)};T.Kc.prototype={Ca:function(){ra(this.Wg.f(this.Oc));this.vk.Z(this.Rd,this.Oc)}};
T.Un=function(a,d){var e=new P;e[5]=-1;var c=oa(0,a,-d,0,-1,1);return new T.Kc(e,c)};
T.ff=function(a,d,e,c){this.c=a=void 0!==a?new R(a):new R(0,0,1);this.Hi=void 0!==d?new R(d):new R(0,0,0);this.dir=ca(new R,this.Hi,a);this.ee=this.dir.Th();this.Oc=new P;this.mj=this.Rd=null;c||(c=(new P).perspective(Math.PI/4,Ta.width/Ta.height,.1,128));this.dir.normalize();this.Bd=void 0!==e?new R(e):this.Aj;this.vc=ea(new R,this.dir,this.Bd);this.Gi=0;this.Rd=c;this.mj=new P;this.O=!0;this.lh=-1;this.Vd=this.Wd=0;this.sb={mg:null,De:new R(0,0,0)}};T.ff.prototype=Object.create(T.Kc.prototype);
T.ff.prototype.update=function(a,d){var e=!1;0<this.lh&&(e=this.lh-this.ee,e=T.j.oa(e,-25*a,25*a),this.ee+=e,e=!0);if(0!==this.Wd||0!==this.Vd){e=T.j.oa(this.Wd,-6.28*a,6.28*a);var c=T.j.oa(this.Vd,-3.14*a,3.14*a),h=Ca(),q=Ca(),r=Ca();la(h,this.vc,c);var g=va().f(this.dir).Ya(h).normalize();0>=ea(va(),g,this.Bd).normalize().cc(this.vc)&&(g.f(this.dir),la(h,this.vc,0));la(q,this.Bd,e);r.Z(q,h);this.dir.Ya(r);ea(this.vc,this.dir,this.Bd).normalize();Ua(this);this.Vd-=c;this.Wd-=e;e=!0}e&&Ua(this);this.sb.mg&&
0<=this.sb.mg.mq&&((e=this.sb.mg.So(a,d))?(this.sb.De.f(this.vc).scale(e[0]),this.sb.De.td(this.dir,e[2])):ia(this.sb.De,0,0,0),this.O=!0,Va(this))};function Ua(a){a.c.f(a.Hi);if(0!==a.Gi){var d=ea(va(),a.vc,a.dir).normalize();d=la(Ca(),d,a.Gi);d=va().f(a.dir).Ya(d)}else d=a.dir;a.c.td(d,-a.ee);a.O=!0;Va(a)}
function Va(a){if(a.O){var d=va().ej(a.c,a.sb.De),e=a.Oc,c=a.dir,h=a.Bd,q=d[0],r=d[1];d=d[2];var g=h[0];var p=h[1];var m=h[2];h=-c[0];var f=-c[1];var k=-c[2];var n=1/Math.sqrt(h*h+f*f+k*k);h*=n;f*=n;k*=n;c=p*k-m*f;m=m*h-g*k;g=g*f-p*h;(n=Math.sqrt(c*c+m*m+g*g))?(n=1/n,c*=n,m*=n,g*=n):g=m=c=0;p=f*g-k*m;var t=k*c-h*g;var x=h*m-f*c;(n=Math.sqrt(p*p+t*t+x*x))?(n=1/n,p*=n,t*=n,x*=n):x=t=p=0;e[0]=c;e[1]=p;e[2]=h;e[3]=0;e[4]=m;e[5]=t;e[6]=f;e[7]=0;e[8]=g;e[9]=x;e[10]=k;e[11]=0;e[12]=-(c*q+m*r+g*d);e[13]=
-(p*q+t*r+x*d);e[14]=-(h*q+f*r+k*d);e[15]=1;a.mj.Z(a.Rd,a.Oc);a.O=!1}}T.ff.prototype.Aj=new R(0,1,0);T.Ye=function(a,d,e){this.Jl=[];e&&this.Jl.push(e)};T.Ye.prototype={};T.Ye.prototype.lk=function(){};T.Ye.prototype.lk.prototype={};
T.Tj=function(a){function d(q){q||(q=a.cloneNode(!0));this.kh=q;this.Ce=!1;var r=this;q.addEventListener("ended",function(){q.loop?q.currentTime=0:r.Ui()});q.addEventListener("durationchange",function(){e.duration=q.duration});q.addEventListener("error",function(){console.log("audio error: ",q)})}var e=this;a.load();this.duration=1;d.prototype={Ui:function(){if(this.Ce){this.Ce=!1;var q=this.kh;q.pause();q.currentTime=0;c.bm(this)}}};var c=new T.Zb.Jc(d),h=c.Mf();h.Ce=!0;h.Ui();this.om=c};
T.Tj.prototype={play:function(a,d){d=d||!1;var e=this.om.Mf(),c=e.kh;c.volume=void 0!==a?a:1;e.Ce=!0;c.currentTime=0;c.loop=d?!0:!1;c=c.play();void 0!==c&&c.then(function(){})["catch"](function(h){console.log(h)});return e}};var Wa=new T.la.Gg,Ta=document.getElementById("canvas");document.getElementById("files_in").addEventListener("change",Xa,!1);var Ya;
function Xa(a){a=a.target.files;var d=0,e=0;Ya=[];a=Array.from(a);a=a.filter(function(c){return c.type.match("image.*")});d=a.length;a.forEach(function(c){var h=new FileReader;h.onload=function(){var q=h.result,r=new Image(64,64);r.src=q;r.onload=function(){var g=document.createElement("canvas"),p=g.getContext("2d");g.width=64;g.height=64;p.drawImage(r,0,0,g.width,g.height);p=c.name;"svg"===T.zb.ql(p)&&(p=T.zb.Vi(p)+".png");g.name=p;Ya.push(g);e++;e===d&&(Wa.mc(),Wa.Vl(Ya),Wa.Zk(Ta))}};h.readAsDataURL(c)})}
document.getElementById("download").addEventListener("click",function(){var a=document.getElementById("filename").value;a=T.zb.Vi(a);T.zb.Ch(Ta,a+".png");T.zb.Ch(JSON.stringify(Wa.qc),a+".json")},!1);